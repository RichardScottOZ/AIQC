<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta property="og:title" content="Low-Level API [under construction for v7.0.0]" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aiqc.readthedocs.io/notebooks/api_low_level.html" />
  <meta property="og:site_name" content="AIQC" />
  <meta property="og:description" content="98ccca93bfeb4a019f99c92d7e2eb1dc,,,, Argument, Type, Default, Description,,, item, type, None, text,, item, type, None, text,, item, type, None, text,, item, type, None, text,, item, type, None, te..." />
  <meta property="og:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/_static/images/web/meta_image_tall_rect.png" />
  <meta property="og:image:alt" content="Artificial Intelligence Quality Control" />
  <meta property="twitter:image" content="https://raw.githubusercontent.com/aiqc/aiqc/main/docs/_static/images/web/meta_image_tall_rect.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Low-Level API [under construction for v7.0.0] &mdash; AIQC</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Datasets" href="datasets.html" />
    <link rel="prev" title="High-Level API" href="api_high_level.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/aiqc_logo_square_blues_transparent.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#TLDR">TLDR</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#Environment">Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Python-Version">Python Version</a><ul>
<li class="toctree-l4"><a class="reference internal" href="installation.html#Pickle-Disclaimer">Pickle Disclaimer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Operating-System">Operating System</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Optional---JupyterLab-IDE">Optional - JupyterLab IDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Plotting">Plotting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="installation.html#Optional---Plotly-in-JupyterLab">Optional - Plotly in JupyterLab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Optional---Swap-Space-for-Failover-Memory">Optional - Swap Space for Failover Memory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#AIQC-Package">AIQC Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#Config-File">Config File</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#Location-of-AIQC-Files">Location of AIQC Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Location-Based-on-OS">Location Based on OS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#Optional---Deleting-the-Database">Optional - Deleting the Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#a)-One-Liner">a) One-Liner</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#b)-Or-Line-by-Line">b) Or Line-by-Line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#Troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#Reloading-the-Package">Reloading the Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboards</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html#Experiment-Tracker">Experiment Tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html#Compare-Models-Head-to-Head">Compare Models Head-to-Head</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html#Runtime">Runtime</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard.html#Troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization &amp; Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#Overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#Classification">Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#Queue-Visualization">Queue Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#Queue-Metrics">Queue Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#Job-Visualization">Job Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#Job-Metrics">Job Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#Regression">Regression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#id1">Queue Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#id2">Queue Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#id3">Job Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#id4">Job Metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_high_level.html">High-Level API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api_high_level.html#Declarative">Declarative</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_high_level.html#1.-Pipeline">1. <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_high_level.html#1a.-Input">1a. <code class="docutils literal notranslate"><span class="pre">Input</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="api_high_level.html#1ai.-Input.Interpolater">1ai. <code class="docutils literal notranslate"><span class="pre">Input.Interpolater</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api_high_level.html#1aii.-Input.Window">1aii. <code class="docutils literal notranslate"><span class="pre">Input.Window</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api_high_level.html#1aiii.-Input.Encoder">1aiii. <code class="docutils literal notranslate"><span class="pre">Input.Encoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api_high_level.html#1b.-Target">1b. <code class="docutils literal notranslate"><span class="pre">Target</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="api_high_level.html#1bi.-Target.Interpolater">1bi. <code class="docutils literal notranslate"><span class="pre">Target.Interpolater</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api_high_level.html#1bii.-Target.Encoder">1bii. <code class="docutils literal notranslate"><span class="pre">Target.Encoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api_high_level.html#1c.-Stratifier">1c. <code class="docutils literal notranslate"><span class="pre">Stratifier</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api_high_level.html#2.-Experiment">2. <code class="docutils literal notranslate"><span class="pre">Experiment</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_high_level.html#2a.-Architecture">2a. <code class="docutils literal notranslate"><span class="pre">Architecture</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="api_high_level.html#2b.-Trainer">2b. <code class="docutils literal notranslate"><span class="pre">Trainer</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api_high_level.html#3.-Inference">3. <code class="docutils literal notranslate"><span class="pre">Inference</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Low-Level API [under construction for v7.0.0]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Object-Relational-Model-(ORM)">Object-Relational Model (ORM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Dataset">1. <code class="docutils literal notranslate"><span class="pre">Dataset</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1a.-Overview">1a. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1b.-Registration">1b. Registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#1bi.-Dataset.Tabular">1bi. <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#1bii.-Dataset.Sequence">1bii. <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#1biii.-Dataset.Image">1biii. <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#1c.-Fetching">1c. Fetching</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1bi. <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">1bii. <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">1biii. <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Selecting-Features-and-Labels.">2. Selecting <code class="docutils literal notranslate"><span class="pre">Features</span></code> and <code class="docutils literal notranslate"><span class="pre">Labels</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a)-Select-the-Label-column(s).">a) Select the <code class="docutils literal notranslate"><span class="pre">Label</span></code> column(s).</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ORM">ORM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Deriving-Labels">Deriving Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-Labels">Reading Labels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Select-the-Feature-column(s).">b) Select the <code class="docutils literal notranslate"><span class="pre">Feature</span></code> column(s).</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">ORM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Specifying-Features">Specifying Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-Features">Reading Features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Slicing-samples.">3. Slicing samples.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a)-Define-sliding-time-series-Windows.">a) Define sliding time series <code class="docutils literal notranslate"><span class="pre">Windows</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">ORM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Specifying-Windows">Specifying Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-Windows">Reading Windows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Slice-samples-with-a-Splitset.">b) Slice samples with a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Stratification">Stratification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Splitting-Strategies">Splitting Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-Splitsets">Reading Splitsets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#c)-fold_count-triggers-cross-validation.">c) <code class="docutils literal notranslate"><span class="pre">fold_count</span></code> triggers cross-validation.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">ORM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fold-objects"><code class="docutils literal notranslate"><span class="pre">Fold</span></code> objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Specifying-Folds">Specifying Folds</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-Folds">Reading Folds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Preprocessing---Interpolation.">4. Preprocessing - Interpolation.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">ORM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a)-Interpolate-Labels-with-LabelInterpolater.">a) Interpolate Labels with <code class="docutils literal notranslate"><span class="pre">LabelInterpolater</span></code>.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Interpolate-Features-with-Interpolaterset.">b) Interpolate Features with <code class="docutils literal notranslate"><span class="pre">Interpolaterset</span></code>.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Preprocessing---Encoding.">5. Preprocessing - Encoding.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Encoding">Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a)-Encode-labels-with-LabelCoder.">a) Encode labels with <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Creating-a-LabelCoder">Creating a <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Encode-Features-sequentially-with-FeatureCoders.">b) Encode Features sequentially with <code class="docutils literal notranslate"><span class="pre">FeatureCoders</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Filtering-feature-columns">Filtering feature columns</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#6.-Preprocessing---Reshaping.">6. Preprocessing - Reshaping.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">ORM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reshaping-by-Index">Reshaping by Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reshaping-Explicitly">Reshaping Explicitly</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Multiplicative-Reshaping">Multiplicative Reshaping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#7.-Defining-Architectures-&amp;-Hyperparameters.">7. Defining Architectures &amp; Hyperparameters.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a)-Define-an-Algorithm">a) Define an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Model-Definition">Model Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Group-the-functions-together-in-an-Algorithm!">Group the functions together in an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>!</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Combinations-of-hyperparameters-with-Hyperparamset.">b) Combinations of hyperparameters with <code class="docutils literal notranslate"><span class="pre">Hyperparamset</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Hyperparameter-Selection-Strategies.">Hyperparameter Selection Strategies.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Hyperparamcombo-objects."><code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code> objects.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#8.-Queue-of-training-Jobs.">8. <code class="docutils literal notranslate"><span class="pre">Queue</span></code> of training <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a)-Job-objects.">a) <code class="docutils literal notranslate"><span class="pre">Job</span></code> objects.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b)-Executing-Jobs.">b) Executing <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#i)-queue.run_jobs()">i) <code class="docutils literal notranslate"><span class="pre">queue.run_jobs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ii)-DEPRECATED---queue.run_jobs(in_background=True).">ii) DEPRECATED - <code class="docutils literal notranslate"><span class="pre">queue.run_jobs(in_background=True)</span></code>.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#c)-Predictors-are-the-trained-models.">c) <code class="docutils literal notranslate"><span class="pre">Predictors</span></code> are the trained models.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Fetching-the-trained-model.">Fetching the trained model.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fetching-the-hyperparameters.">Fetching the hyperparameters.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#d)-Predictions-are-the-output-of-a-Predictor.">d) <code class="docutils literal notranslate"><span class="pre">Predictions</span></code> are the output of a Predictor.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Fetching-metrics.">Fetching metrics.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#9.-Metrics-&amp;-Visualization">9. Metrics &amp; Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="datasets.html#Overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html#Prepackaged-Local-Data">Prepackaged Local Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html#Remote-Data">Remote Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html#Alternative-Sources">Alternative Sources</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/explainer.html">Deep Learning 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/community.html">Open Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#how-can-i-get-involved">How can I get involved?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#how-can-i-contribute">How can I contribute?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#setting-up-dev-environment">Setting up dev environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#programming-style">Programming style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#code-of-conduct">Code of conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#guild-bylaws-aka-governance">Guild bylaws (aka governance)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#aiqc-inc-is-open-core">AIQC, Inc. is open core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/community.html#id1">Open source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pages/community.html#choosing-a-license">Choosing a license</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pages/compare.html">Competition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/mission.html">Mission</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pages/mission.html#why-does-aiqc-exist">Why Does AIQC Exist?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/mission.html#accelerate-science-by-making-deep-learning-accessible">1. Accelerate science by making deep learning accessible.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/mission.html#bring-the-scientific-method-to-data-science">2. Bring the scientific method to data science.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pages/mission.html#break-down-walled-gardens-to-keep-science-open">3. Break down walled gardens to keep science open.</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AIQC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Low-Level API [under construction for v7.0.0]</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/api_low_level.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Low-Level-API-[under-construction-for-v7.0.0]">
<h1>Low-Level API [under construction for v7.0.0]<a class="headerlink" href="#Low-Level-API-[under-construction-for-v7.0.0]" title="Permalink to this headline"></a></h1>
<p><img alt="98ccca93bfeb4a019f99c92d7e2eb1dc" class="banner-photo" src="../_images/pipes.png" /></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 13%" />
<col style="width: 23%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>item</em></p></td>
<td><p>type</p></td>
<td><p>None</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-odd"><td><p><em>item</em></p></td>
<td><p>type</p></td>
<td><p>None</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-even"><td><p><em>item</em></p></td>
<td><p>type</p></td>
<td><p>None</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-odd"><td><p><em>item</em></p></td>
<td><p>type</p></td>
<td><p>None</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-even"><td><p><em>item</em></p></td>
<td><p>type</p></td>
<td><p>None</p></td>
<td><p>text</p></td>
</tr>
</tbody>
</table>
<section id="Object-Relational-Model-(ORM)">
<h2>Object-Relational Model (ORM)<a class="headerlink" href="#Object-Relational-Model-(ORM)" title="Permalink to this headline"></a></h2>
<p>The Low-Level API is an <em>object-relational model</em> for machine learning. Each class in the <a class="reference external" href="http://docs.peewee-orm.com/en/latest/peewee/models.html">ORM</a> maps to a table in a SQLite database that serves as a machine learning <em>metastore</em>.</p>
<p>The real power lies in the relationships between these objects (e.g. <code class="docutils literal notranslate"><span class="pre">Label</span></code>→<code class="docutils literal notranslate"><span class="pre">Splitset</span></code>←<code class="docutils literal notranslate"><span class="pre">Feature</span></code> and <code class="docutils literal notranslate"><span class="pre">Queue</span></code>→<code class="docutils literal notranslate"><span class="pre">Job</span></code>→<code class="docutils literal notranslate"><span class="pre">Predictor</span></code>→<code class="docutils literal notranslate"><span class="pre">Prediction</span></code>), which enable us to construct rule-base protocols for various types of data and analysis.</p>
<p>Goobye, <em>X_train, y_test</em>. Hello, object-oriented machine learning.</p>
<hr class="docutils" />
</section>
<section id="1.-Dataset">
<h2>1. <code class="docutils literal notranslate"><span class="pre">Dataset</span></code><a class="headerlink" href="#1.-Dataset" title="Permalink to this headline"></a></h2>
<section id="1a.-Overview">
<h3>1a. Overview<a class="headerlink" href="#1a.-Overview" title="Permalink to this headline"></a></h3>
<img alt="Datasets" src="../_images/dimensions.png" />
<p>The <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> class provides the following subclasses for working with different types of data:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Subclass</p></th>
<th class="head"><p>Dimensionality</p></th>
<th class="head"><p>Supported Formats</p></th>
<th class="head"><p>Format (if ingested)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Tabular</strong></p></td>
<td><p>2D</p></td>
<td><p>Files (Parquet, CSV, TSV, Parquet) / Pandas DataFrame (in-memory)</p></td>
<td><p>Parquet</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Sequence</strong></p></td>
<td><p>3D</p></td>
<td><p>NumPy (in-memory ndarray, npy file)</p></td>
<td><p>npy</p></td>
</tr>
<tr class="row-even"><td><p><strong>Image</strong></p></td>
<td><p>4D</p></td>
<td><p>NumPy (in-memory ndarray, npy file) / Pillow-supported formats</p></td>
<td><p>npy</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>The names are merely suggestive, as the primary purpose of these subclasses is to provide a way to register data of a known dimension. For example, a practitioner could ingest many uni-channel/ grayscale images as a 3D Sequence Dataset instead of a multi-channel 4D Image Dataset.</p>
</div></blockquote>
<blockquote>
<div><p><em>Why not 2D NumPy?</em> The <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> class is intended for strict, column-specific dtypes and Parquet persistence upon ingestion. In practice, this conflicted too often with NumPy’s array-wide dtyping. We use the best tools for the job (df/pq for 2D) and (array/npy for ND).</p>
</div></blockquote>
<hr class="docutils" />
</section>
<section id="1b.-Registration">
<h3>1b. Registration<a class="headerlink" href="#1b.-Registration" title="Permalink to this headline"></a></h3>
<p><em>Most of the Dataset registration methods share these arguments:</em></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>ingest</strong></p></td>
<td><p>Determines if raw data is either stored directly inside the metastore or remains on disk to be accessed via path/url. <em>In-memory</em> data like DataFrames and ndarrays must be ingested. Whereas <em>file-based</em> data like Parquet, NPY, Image folders/urls
may remain remote. Regardless of whether or not the raw data is ingested, metadata is always derived from it by parsing: 2D via DataFrame and N-D via ndarray.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>rename_columns</strong></p></td>
<td><p>Useful for assigning column names to arrays or delimited files that would otherwise be unnamed. <code class="docutils literal notranslate"><span class="pre">len(rename_columns)</span></code> must match the number of columns in the raw data. Normally, an int-based range is assigned to unnamed columns. In this case,
AIQC converts each column name to a string e.g. ‘1’ during the registration process.</p></td>
</tr>
<tr class="row-even"><td><p><strong>retype</strong></p></td>
<td><p>Change the dtype of data using <a class="reference external" href="https://numpy.org/doc/stable/user/basics.types.html">np.types</a>. All Dataset subclasses support mass typing via <code class="docutils literal notranslate"><span class="pre">np.type</span></code>/ <code class="docutils literal notranslate"><span class="pre">str(np.type)</span></code>. Only the Tabular subclass supports inidividual column retyping via
<code class="docutils literal notranslate"><span class="pre">dict(column=np.type)</span></code>. If <code class="docutils literal notranslate"><span class="pre">rename_columns</span></code> is used in conjuction with <code class="docutils literal notranslate"><span class="pre">retype=dict()</span></code>, then each <code class="docutils literal notranslate"><span class="pre">dict['column']</span></code> key must match its counterpart in rename_columns.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>description</strong></p></td>
<td><p>What information does this dataset contain? What is unique about this dataset/ version – did you edit the raw data, add rows, or change column names/ dtypes?</p></td>
</tr>
<tr class="row-even"><td><p><strong>name</strong></p></td>
<td><p>Triggers dataset <em>versioning</em>. Datasets that share a name will be assigned an auto-incrementing <code class="docutils literal notranslate"><span class="pre">version:int</span></code> number provided that they are not duplicates of each other based on a <code class="docutils literal notranslate"><span class="pre">sha256_hexdigest:str</span></code> hash. If you try to create an exact
duplicate, it will warn you and <code class="docutils literal notranslate"><span class="pre">return</span></code> the matching duplicate instead of creating a new entity. This behavior makes it easy to rerun pipelines where Datasets are created inline.</p></td>
</tr>
</tbody>
</table>
<p><em>Ingestion provides the following benefits, especially for entry-level users:</em></p>
<ul class="simple">
<li><p>Persist in-memory datasets (Pandas DataFrames, NumPy ndarrays).</p></li>
<li><p>Keeps data coupled with the experiment in the portable SQLite file.</p></li>
<li><p>Provides a more immutable and out-of-the-way storage location in comparison to a laptop file system.</p></li>
<li><p>Encourages preserving tabular dtypes with the ecosystem-friendly Parquet format.</p></li>
</ul>
<p><em>Why would I avoid ingestion?</em></p>
<ul class="simple">
<li><p>Happy with where the original data lives: e.g. S3 bucket.</p></li>
<li><p>Don’t want to duplicate the data.</p></li>
</ul>
<blockquote>
<div><p><em>sha256?</em> – It’s the one-way hash algorithm that GitHub aspires to upgrade to. AIQC runs it on compressed data because it’s easier and probably less-error prone than intercepting the bytes of the <em>fastparquet</em> intermediary tables before appending the Parquet magic bytes.</p>
</div></blockquote>
<blockquote>
<div><p><em>Is SQLite a legitimate datastore?</em> – In many cases, SQLite queries are faster than accessing data via a filesystem. It’s a stable, 22 year-old technology that serves as the default database for iOS e.g. Apple Photos. AIQC uses it store raw data in byte format as a BlobField. I’ve stored tens-of-thousands of files in it over several years and never experienced corruption. Keep in mind that AWS S3 is blob store, and the Microsoft equivalent service is literally called Azure <em>Blob</em> Storage. The
max size of a BlobField is 2GB, so ~20GB after compression. Either way, the goal of machine learning isn’t to record the entire population within the weights of a neural network, it’s to find subsets that are representative of the broader population.</p>
</div></blockquote>
<hr class="docutils" />
<section id="1bi.-Dataset.Tabular">
<h4>1bi. <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code><a class="headerlink" href="#1bi.-Dataset.Tabular" title="Permalink to this headline"></a></h4>
<p>Here are some of the ways practitioners can use this 2D structure:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Multiple subjects (1 row per sample)</p></td>
<td><p>*</p></td>
<td><p>Multi-variate 1D (1 col per attribute)</p></td>
</tr>
<tr class="row-even"><td><p>Single subject (1 row per timestamp)</p></td>
<td><p>*</p></td>
<td><p>Multi-variate 1D (1 col per attribute)</p></td>
</tr>
<tr class="row-odd"><td><p>Multiple subjects (1 row per timestamp)</p></td>
<td><p>*</p></td>
<td><p>Uni-variate 0D (1 col per sample)</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Tabular datasets may contain both features and labels</p>
</div></blockquote>
<hr class="docutils" />
<section id="└──-Dataset.Tabular.from_df()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_df()</span></code><a class="headerlink" href="#└──-Dataset.Tabular.from_df()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span>
    <span class="n">dataframe</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>df</strong></p></td>
<td><p>DataFrame</p></td>
<td><p>Required</p></td>
<td><p><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas-dataframe">pd.DataFrame</a> with int-based
single index. DataFrames are always ingested.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="└──-Dataset.Tabular.from_path()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.from_path()</span></code><a class="headerlink" href="#└──-Dataset.Tabular.from_path()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="o">.</span><span class="n">Tabular</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span>
    <span class="n">file_path</span>
    <span class="p">,</span> <span class="n">ingest</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">header</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>file_path</strong></p></td>
<td><p>str</p></td>
<td><p>Required</p></td>
<td><p>Parsed based on how the file name ends (.parquet, .tsv, .csv)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ingest</strong></p></td>
<td><p>bool</p></td>
<td><p>True</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a>. Defaults to True because I don’t want to rely on CSV files as a source of truth
for dtypes, and compression works great in Parquet.</p></td>
</tr>
<tr class="row-even"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>header</strong></p></td>
<td><p>object</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
</section>
<section id="1bii.-Dataset.Sequence">
<h4>1bii. <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code><a class="headerlink" href="#1bii.-Dataset.Sequence" title="Permalink to this headline"></a></h4>
<p>Here are some of the ways practitioners can use this 3D structure:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 53%" />
<col style="width: 4%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Single subject (1 patient)</p></td>
<td><p>*</p></td>
<td><p>Multiple 2D sequences</p></td>
</tr>
<tr class="row-even"><td><p>Multiple subjects</p></td>
<td><p>*</p></td>
<td><p>Single 2D sequence</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Sequence datasets are somewhat multi-modal in that, in order to perform supervised learning on them, they must eventually be paired with a <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> that acts as its <code class="docutils literal notranslate"><span class="pre">Label</span></code>.</p>
</div></blockquote>
<hr class="docutils" />
<section id="└──-Dataset.Sequence.from_numpy()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence.from_numpy()</span></code><a class="headerlink" href="#└──-Dataset.Sequence.from_numpy()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="o">.</span><span class="n">Sequence</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
    <span class="n">arr3D_or_npyPath</span>
    <span class="p">,</span> <span class="n">ingest</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>arr3D_or_npyPath</strong></p></td>
<td><p>object / str</p></td>
<td><p>Required</p></td>
<td><p>3D array in the form of either an <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html">ndarray</a> or
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html">npy</a> file path</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ingest</strong></p></td>
<td><p>bool</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a>. If left blank, ndarrays will be ingested and npy will not. Errors if ndarray and
False.</p></td>
</tr>
<tr class="row-even"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
</section>
<section id="1biii.-Dataset.Image">
<h4>1biii. <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code><a class="headerlink" href="#1biii.-Dataset.Image" title="Permalink to this headline"></a></h4>
<p>Here are some of the ways you can practitioners this 4D structure:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 57%" />
<col style="width: 4%" />
<col style="width: 39%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Single subject (1 patient)</p></td>
<td><p>*</p></td>
<td><p>Multiple 3D images</p></td>
</tr>
<tr class="row-even"><td><p>Multiple subjects</p></td>
<td><p>*</p></td>
<td><p>Single 3D image</p></td>
</tr>
</tbody>
</table>
<p>Users can ingest 4D data using either: - <a class="reference external" href="pillow.readthedocs.io/en/stable/handbook/image-file-formats.html">The Pillow library, which supports various formats</a> - Or NumPy arrays as a simple alternative</p>
<blockquote>
<div><p>Image datasets are somewhat multi-modal in that, in order to perform supervised learning on them, they must eventually be paired with a <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> that acts as its <code class="docutils literal notranslate"><span class="pre">Label</span></code>.</p>
</div></blockquote>
<hr class="docutils" />
<section id="└──-Dataset.Image.from_numpy()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_numpy()</span></code><a class="headerlink" href="#└──-Dataset.Image.from_numpy()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
    <span class="n">arr4D_or_npyPath</span>
    <span class="p">,</span> <span class="n">ingest</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>arr4D_or_npyPath</strong></p></td>
<td><p>object / str</p></td>
<td><p>Required</p></td>
<td><p>4D array in the form of either an <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html">ndarray</a> or
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html">npy</a> file path</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ingest</strong></p></td>
<td><p>bool</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a>. If left blank, ndarrays will be ingested and npy will not. Errors if ndarray and
False.</p></td>
</tr>
<tr class="row-even"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="└──-Dataset.Image.from_folder()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_folder()</span></code><a class="headerlink" href="#└──-Dataset.Image.from_folder()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span>
    <span class="n">folder_path</span>
    <span class="p">,</span> <span class="n">ingest</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>folder_path</strong></p></td>
<td><p>str</p></td>
<td><p>Required</p></td>
<td><p>Folder of images to be ingested via Pillow. All images must be cropped to the same dimensions ahead of time.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ingest</strong></p></td>
<td><p>bool</p></td>
<td><p>False</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="└──-Dataset.Image.from_urls()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">Dataset.Image.from_urls()</span></code><a class="headerlink" href="#└──-Dataset.Image.from_urls()" title="Permalink to this headline"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_urls</span><span class="p">(</span>
    <span class="n">urls</span>
    <span class="p">,</span> <span class="n">source_path</span>
    <span class="p">,</span> <span class="n">ingest</span>
    <span class="p">,</span> <span class="n">rename_columns</span>
    <span class="p">,</span> <span class="n">retype</span>
    <span class="p">,</span> <span class="n">description</span>
    <span class="p">,</span> <span class="n">name</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>urls</strong></p></td>
<td><p>list(str)</p></td>
<td><p>Required</p></td>
<td><p>URLs that point to an image to be ingested via Pillow. All images must be cropped to the same dimensions ahead of time.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>source_path</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>Optionally record a shared directory, bucket, or FTP site where images are stored. The backend won’t use this information
for anything.</p></td>
</tr>
<tr class="row-even"><td><p><strong>ingest</strong></p></td>
<td><p>bool</p></td>
<td><p>False</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>rename_columns</strong></p></td>
<td><p>list[str]</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>retype</strong></p></td>
<td><p>np.type / dict(column:np.type)</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-odd"><td><p><strong>description</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
<tr class="row-even"><td><p><strong>name</strong></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>See <a class="reference external" href="#1b.-Registration">Registration</a></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
</section>
</section>
<section id="1c.-Fetching">
<h3>1c. Fetching<a class="headerlink" href="#1c.-Fetching" title="Permalink to this headline"></a></h3>
<p>All of the sample-related objects in the API have <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code> and <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code> methods that accept the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples=[]</span></code> list of indices to fetch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns=[]</span></code> list of columns to fetch.</p></li>
<li><p>In some cases you can specify a <code class="docutils literal notranslate"><span class="pre">split</span></code>/ <code class="docutils literal notranslate"><span class="pre">fold</span></code> name.</p></li>
</ul>
<p>For structured data, since the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> itself is fairly removed from the <code class="docutils literal notranslate"><span class="pre">File.Tabular</span></code> it creates, you can get that tabular file with <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular.get_main_tabular(dataset_id)</span></code> to inspect attributes like <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code>.</p>
<hr class="docutils" />
<section id="id1">
<h4>1bi. <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code><a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<section id="└──-to_pandas()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code><a class="headerlink" href="#└──-to_pandas()" title="Permalink to this headline"></a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">79</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;sepal_width&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4.3</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>4.7</td>
      <td>3.2</td>
    </tr>
    <tr>
      <th>79</th>
      <td>5.7</td>
      <td>2.6</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<hr class="docutils" />
</section>
<section id="└──-to_numpy()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code><a class="headerlink" href="#└──-to_numpy()" title="Permalink to this headline"></a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">79</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;petal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_width&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[1.4, 0.2],
       [1.1, 0.1],
       [1.6, 0.2],
       [3.5, 1. ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5.1, 3.5, 1.4, 0.2, &#39;setosa&#39;],
       [4.9, 3.0, 1.4, 0.2, &#39;setosa&#39;],
       [4.7, 3.2, 1.3, 0.2, &#39;setosa&#39;],
       [4.6, 3.1, 1.5, 0.2, &#39;setosa&#39;]], dtype=object)
</pre></div></div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="id2">
<h4>1bii. <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code><a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<section id="id3">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code><a class="headerlink" href="#id3" title="Permalink to this headline"></a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
<span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([5.1, 3.5, 1.4, 0.2, &#39;setosa&#39;], dtype=object)
</pre></div></div>
</div>
<p>This essentially internal method only exists to enable Pandas-related preprocessing such as interpolation. Produces a list of dataframes.</p>
</section>
<section id="id4">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_pandas()</span></code><a class="headerlink" href="#id4" title="Permalink to this headline"></a></h5>
<p>This essentially internal method only exists to enable Pandas-related preprocessing such as interpolation. Produces a list of dataframes.</p>
</section>
<section id="└──-to_pillow()">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_pillow()</span></code><a class="headerlink" href="#└──-to_pillow()" title="Permalink to this headline"></a></h5>
<p>This essentially internal method only exists to fetch images in their natural form (e.g. PNG/JPG).</p>
<hr class="docutils" />
</section>
</section>
<section id="id5">
<h4>1biii. <code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code><a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<section id="id6">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_pillow()</span></code><a class="headerlink" href="#id6" title="Permalink to this headline"></a></h5>
<p>Returns a list of <code class="docutils literal notranslate"><span class="pre">PIL.Image</span></code>’s. You can actually see the image when you call them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">images_pillow</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">to_pillow</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">image_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">62</span><span class="p">])</span>
<span class="n">images_pillow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_api_low_level_86_0.png" src="../_images/notebooks_api_low_level_86_0.png" />
</div>
</div>
<hr class="docutils" />
</section>
<section id="id7">
<h5>└── <code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code><a class="headerlink" href="#id7" title="Permalink to this headline"></a></h5>
<p>This simply performs <code class="docutils literal notranslate"><span class="pre">np.array(Pillow.Image)</span></code>. Returns an N-dimensional array where the dimensions vary based on the <code class="docutils literal notranslate"><span class="pre">mode</span></code> aka colorscale of the image. For example, it returns ‘3D of 2Ds for black and white’ or ‘4D of 3Ds for colored’ - which would change the class of convultional layer you would use (<code class="docutils literal notranslate"><span class="pre">Conv1D</span></code>:<code class="docutils literal notranslate"><span class="pre">Conv3D</span></code>).</p>
<blockquote>
<div><p>By default, the returned arrays will be scaled by 255 because <a class="reference external" href="https://pillow.readthedocs.io/en/stable/handbook/concepts.html#modes">Pillow pixel values range from 0-255</a>.</p>
</div></blockquote>
<p>Let’s check out one of the 2D color channels of a grayscale image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">images_pillow</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">image_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">62</span><span class="p">])</span>
<span class="n">images_pillow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[[20, 19, 18, ..., 77, 78, 78],
        [19, 19, 17, ..., 56, 56, 57],
        [19, 18, 17, ..., 41, 41, 41],
        ...,
        [ 7,  7,  7, ...,  8,  8,  8],
        [ 7,  7,  7, ...,  8,  8,  8],
        [ 7,  7,  7, ...,  8,  8,  8]]], dtype=uint8)
</pre></div></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>
</section>
<section id="2.-Selecting-Features-and-Labels.">
<h2>2. Selecting <code class="docutils literal notranslate"><span class="pre">Features</span></code> and <code class="docutils literal notranslate"><span class="pre">Labels</span></code>.<a class="headerlink" href="#2.-Selecting-Features-and-Labels." title="Permalink to this headline"></a></h2>
<section id="a)-Select-the-Label-column(s).">
<h3>a) Select the <code class="docutils literal notranslate"><span class="pre">Label</span></code> column(s).<a class="headerlink" href="#a)-Select-the-Label-column(s)." title="Permalink to this headline"></a></h3>
<section id="ORM">
<h4>ORM<a class="headerlink" href="#ORM" title="Permalink to this headline"></a></h4>
<p>From a Dataset, pick the column(s) that you want to predict/ train against. Creating a <code class="docutils literal notranslate"><span class="pre">Label</span></code> won’t duplicate your data! It simply marks the Dataset <code class="docutils literal notranslate"><span class="pre">columns</span></code> to be used for supervised learning.</p>
<p>Later, we’ll see that a <code class="docutils literal notranslate"><span class="pre">Label</span></code> triggers:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">supervision</span></code> attribute of a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> to be either <code class="docutils literal notranslate"><span class="pre">'unsupervised'</span></code>/<code class="docutils literal notranslate"><span class="pre">'supervised'</span></code>.</p></li>
<li><p>Approval/ rejection of the <code class="docutils literal notranslate"><span class="pre">Algorithm.analysis_type</span></code>. For example, you wouldn’t perform regression on a string label.</p></li>
</ul>
<p>Part of the magic of this library is that it prevents you from making silly mistakes like these so that you aren’t faced with some obscure NumPy/ Tensor, dtype/ dimensionality error on the nth layer of your neural network.</p>
<p>For categorical labels, but not for continuous/float labels, the <code class="docutils literal notranslate"><span class="pre">Label.unique_classes</span></code> are recorded.</p>
</section>
<section id="Deriving-Labels">
<h4>Deriving Labels<a class="headerlink" href="#Deriving-Labels" title="Permalink to this headline"></a></h4>
<p>Keep the name of the label column handy as you may want to re-use it later when excluding features.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label_column</span> <span class="o">=</span> <span class="s1">&#39;species&#39;</span>
</pre></div>
</div>
</div>
<p>Implicit IDs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">columns=[label_column]</span></code> is a list in case users have already OneHotEncoded (OHEd) their label. If multiple columns are provided, then they must already be in OHE format. I’m not keen on supporting multi-label/ simultaneous analysis, but that could changed based on feasibility and user demand.</p>
</div></blockquote>
<p>Explicit IDs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">other_label</span> <span class="o">=</span> <span class="n">Label</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="n">other_dataset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Reading-Labels">
<h4>Reading Labels<a class="headerlink" href="#Reading-Labels" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Label</span></code> comes in handy when we need to fetch what is traditionally referred to as ‘<em>Y</em>’ in tutorials. It also accepts a <code class="docutils literal notranslate"><span class="pre">samples</span></code> argument, so that <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> can subset it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>145</th>
      <td>virginica</td>
    </tr>
    <tr>
      <th>146</th>
      <td>virginica</td>
    </tr>
    <tr>
      <th>147</th>
      <td>virginica</td>
    </tr>
    <tr>
      <th>148</th>
      <td>virginica</td>
    </tr>
    <tr>
      <th>149</th>
      <td>virginica</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span><span class="o">.</span><span class="n">to_arr</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">132</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[&#39;setosa&#39;],
       [&#39;setosa&#39;],
       [&#39;versicolor&#39;],
       [&#39;versicolor&#39;],
       [&#39;virginica&#39;]], dtype=object)
</pre></div></div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="b)-Select-the-Feature-column(s).">
<h3>b) Select the <code class="docutils literal notranslate"><span class="pre">Feature</span></code> column(s).<a class="headerlink" href="#b)-Select-the-Feature-column(s)." title="Permalink to this headline"></a></h3>
<section id="id8">
<h4>ORM<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h4>
<p>Creating a Feature won’t duplicate your data! It simply records the Dataset <code class="docutils literal notranslate"><span class="pre">columns</span></code> to be used as features during training.</p>
<p>There are three ways to define which columns you want to use as features:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exclude_columns=[]</span></code> for ruling out columns like the <code class="docutils literal notranslate"><span class="pre">Label</span></code> column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_columns=[]</span></code> for being selective.</p></li>
<li><p>Leave both of the above blank and all columns will be used (e.g. images or unsupervised leanring).</p></li>
</ul>
<p>For structured data, since the Feature is far removed from the <code class="docutils literal notranslate"><span class="pre">File.Tabular</span></code> that it is derived from, there is a <code class="docutils literal notranslate"><span class="pre">Feature.get_dtypes()</span></code> method. This will come in handy when we are selecting dtypes/columns to include/ exclude in our <code class="docutils literal notranslate"><span class="pre">FeatureCoder</span></code>(s).</p>
</section>
<section id="Specifying-Features">
<h4>Specifying Features<a class="headerlink" href="#Specifying-Features" title="Permalink to this headline"></a></h4>
<p>Via <code class="docutils literal notranslate"><span class="pre">include_columns=[]</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
    <span class="n">dataset_id</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">include_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span>
        <span class="s1">&#39;petal_length&#39;</span><span class="p">,</span>
        <span class="s1">&#39;petal_width&#39;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Or via <code class="docutils literal notranslate"><span class="pre">exclude_columns=[]</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">exclude_columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;, &#39;petal_width&#39;]
</pre></div></div>
</div>
<p>Either way, any excluded columns will be recorded since they are used for dropping.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span><span class="o">.</span><span class="n">columns_excluded</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;species&#39;]
</pre></div></div>
</div>
<p>Again, for images, just perform <code class="docutils literal notranslate"><span class="pre">Dataset.Image.make_feature()</span></code> since you’ll likely want to include all pixels and your label column is in a separate, coupled Dataset.</p>
</section>
<section id="Reading-Features">
<h4>Reading Features<a class="headerlink" href="#Reading-Features" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5.1, 3.5, 1.4, 0.2],
       [4.9, 3. , 1.4, 0.2],
       [4.7, 3.2, 1.3, 0.2],
       [4.6, 3.1, 1.5, 0.2]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>5.4</td>
      <td>3.9</td>
      <td>1.3</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>32</th>
      <td>5.2</td>
      <td>4.1</td>
      <td>1.5</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>64</th>
      <td>5.6</td>
      <td>2.9</td>
      <td>3.6</td>
      <td>1.3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>
<section id="3.-Slicing-samples.">
<h2>3. Slicing samples.<a class="headerlink" href="#3.-Slicing-samples." title="Permalink to this headline"></a></h2>
<section id="a)-Define-sliding-time-series-Windows.">
<h3>a) Define sliding time series <code class="docutils literal notranslate"><span class="pre">Windows</span></code>.<a class="headerlink" href="#a)-Define-sliding-time-series-Windows." title="Permalink to this headline"></a></h3>
<section id="id9">
<h4>ORM<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Window</span></code> object is provided in order to facilitate sliding windows for unsupervised/ self-supervised time series forecasting and backcasting. It assumes that the last time point is the most recent (aka ascending time).</p>
<img alt="Windows" src="../_images/sliding_windows.png" />
<p><strong>Concept of a sliding sample:</strong></p>
<p>The ‘sample’ refers to the highest dimension of the data that is batched just before training.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code> - Here the ‘sample’ is no longer a single row, but rather a group of rows known as a window. Looking at the diagram above, there are 5 samples (<em>0:4</em> windows), not 15 samples (<em>0:14</em> time points).</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code> - Here the ‘sample’ is an array consisting of sliding windows from each sequence. Imagine monitoring the weather of several cities at once, and taking the same windows from each city as a sample.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dataset.Image</span></code> - Here the ‘sample’ is no longer a single image, but rather a group of images known as a window.</p></li>
</ul>
<p><strong>Parameters:</strong> - <code class="docutils literal notranslate"><span class="pre">size_window:int</span></code> the number of points in time to include in a window. - <code class="docutils literal notranslate"><span class="pre">size_shift:int</span></code> the number of points in time to slide forward. - <code class="docutils literal notranslate"><span class="pre">record_shift:bool=True</span></code> used during inference. Only persists unshifted windows and while leaving shifted windows as <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
<section id="Specifying-Windows">
<h4>Specifying Windows<a class="headerlink" href="#Specifying-Windows" title="Permalink to this headline"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">from_feature</span><span class="p">(</span>
    <span class="n">feature_id</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">size_window</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">size_shift</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples_unshifted:list</span> <span class="pre">of</span> <span class="pre">lists</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_shifted:list</span> <span class="pre">of</span> <span class="pre">lists</span></code></p></li>
</ul>
</section>
<section id="Reading-Windows">
<h4>Reading Windows<a class="headerlink" href="#Reading-Windows" title="Permalink to this headline"></a></h4>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">window.samples_unshifted[0]==[1,2,3,4]</span></code>. Where <em>1:4</em> represents the raw, underlying sample indices of that window. This is used when fetching the data. First, the entire <code class="docutils literal notranslate"><span class="pre">Feature</span></code> is fetched for preprocessing, then windows are copied out of it like so:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">np.array([feature_array[w]</span> <span class="pre">for</span> <span class="pre">w</span> <span class="pre">in</span> <span class="pre">window.samples_unshifted])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">np.array([feature_array[w]</span> <span class="pre">for</span> <span class="pre">w</span> <span class="pre">in</span> <span class="pre">window.samples_shifted])</span></code></p></li>
</ul>
<p>Where each of the above arrays is a 3D sequence that is fed into a single recurrent model. The shifted sequence is slotted into <code class="docutils literal notranslate"><span class="pre">samples[&lt;split&gt;]['labels']</span></code> to facilitate self-supervision.</p>
<hr class="docutils" />
</section>
</section>
<section id="b)-Slice-samples-with-a-Splitset.">
<h3>b) Slice samples with a <code class="docutils literal notranslate"><span class="pre">Splitset</span></code>.<a class="headerlink" href="#b)-Slice-samples-with-a-Splitset." title="Permalink to this headline"></a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> divides the samples of the Dataset into the following <em>splits</em> in the table below. It is the central object of the data preparation side of the ORM in that it touches <code class="docutils literal notranslate"><span class="pre">Label</span></code>, <code class="docutils literal notranslate"><span class="pre">Feature</span></code>, and <code class="docutils literal notranslate"><span class="pre">Folds</span></code>. It is the only mandatory data preparation object required by the training <code class="docutils literal notranslate"><span class="pre">Queue</span></code>.</p>
<p>Both continuous and categorical <code class="docutils literal notranslate"><span class="pre">Labels</span></code> are automatically stratified.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Split</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>train</p></td>
<td><p>The samples that the model will be trained upon. Later, we’ll see how we can make <em>cross-folds from our training split</em>. Unsupervised learning will only have a training split.</p></td>
</tr>
<tr class="row-odd"><td><p>validation (optional)</p></td>
<td><p>The samples used for training evaluation. Ensures that the test set is not revealed to the model during training.</p></td>
</tr>
<tr class="row-even"><td><p>test (optional)</p></td>
<td><p>The samples the model has never seen during training. Used to assess how well the model will perform on unobserved, natural data when it is applied in the real world aka how generalizable it is.</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Label-based stratification is used to ensure equally distributed label classes for both categorical and continuous data.</p>
<p>If you want more control over stratification of continuous splits, specify the number of <code class="docutils literal notranslate"><span class="pre">bin_count:int</span></code> for grouping.</p>
</div></blockquote>
<blockquote>
<div><p>Again, creating a Splitset won’t duplicate your data. It simply points to the sample indices to be used in the splits that you specify!</p>
</div></blockquote>
<section id="Stratification">
<h4>Stratification<a class="headerlink" href="#Stratification" title="Permalink to this headline"></a></h4>
<p>All tabular splits are stratified by default in that they contain similar distributions of unique Label classes so that each split is a statistically accurate representation of the population as a whole.</p>
<p>In order to support this process for continuous labels, binning/ discretization is utilized. For example, if 4 bins are used, values from <em>0.0 to 1.0</em> would be binned as <em>[0.0-0.25, 0.25-0.50, 0.50-0.75, 0.75-1.0]</em>. This is controlled by the <code class="docutils literal notranslate"><span class="pre">bin_count:int</span></code> argument.</p>
<blockquote>
<div><p>Reference the handy <code class="docutils literal notranslate"><span class="pre">Pandas.qcut()</span></code> and the source code <code class="docutils literal notranslate"><span class="pre">pd.qcut(x=array_to_bin,</span> <span class="pre">q=bin_count,</span> <span class="pre">labels=False,</span> <span class="pre">duplicates='drop')</span></code> for more detail.</p>
</div></blockquote>
<p>Additionally <code class="docutils literal notranslate"><span class="pre">unsupervised_stratify_column:str</span></code> is provided for scenarios where there is no Label. For example, you may want to stratify by the month during unsupervised time series analysis.</p>
</section>
<section id="Splitting-Strategies">
<h4>Splitting Strategies<a class="headerlink" href="#Splitting-Strategies" title="Permalink to this headline"></a></h4>
<p>Notice that the <code class="docutils literal notranslate"><span class="pre">feature_ids:list</span></code> is plural. That’s because we can pass a Splitset multiple Features for mixed-data analysis (e.g. using both Tabular and Image data).</p>
<blockquote>
<div><p>If you have a feature that is capable of stratification (e.g. <code class="docutils literal notranslate"><span class="pre">dataset_type='tabular'</span></code> or <code class="docutils literal notranslate"><span class="pre">dataset_type='tabular'</span></code>), then you should make that <code class="docutils literal notranslate"><span class="pre">feature_id</span></code> the first element in the list. Only the first list element will be checked for the purposes of stratification.</p>
</div></blockquote>
<section id="i)-Default-supervised-70-30-split.">
<h5>i) Default supervised 70-30 split.<a class="headerlink" href="#i)-Default-supervised-70-30-split." title="Permalink to this headline"></a></h5>
<p>If a Label is provided, then a 70:30 train:test splits will automatically be generated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">Splitset</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">feature_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">label_id</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="ii)-Specifying-test-size.">
<h5>ii) Specifying test size.<a class="headerlink" href="#ii)-Specifying-test-size." title="Permalink to this headline"></a></h5>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">Splitset</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">feature_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
    <span class="p">,</span><span class="n">label_id</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.22</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="iii)-Specifying-validation-size.">
<h5>iii) Specifying validation size.<a class="headerlink" href="#iii)-Specifying-validation-size." title="Permalink to this headline"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">size_validation</span></code> cannot be specified without a <code class="docutils literal notranslate"><span class="pre">size_test</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span> <span class="o">=</span> <span class="n">Splitset</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">feature_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">label_id</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.20</span>
    <span class="p">,</span> <span class="n">size_validation</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="iv)-Unsupervised">
<h5>iv) Unsupervised<a class="headerlink" href="#iv)-Unsupervised" title="Permalink to this headline"></a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>splitset = Splitset.make(
    label_id = None
    , feature_ids = [feature.id]
    , size_test=0.12
    , size_validation=0.16
)
</pre></div>
</div>
</section>
<section id="v)-Take-all-samples-for-inference">
<h5>v) Take all samples for inference<a class="headerlink" href="#v)-Take-all-samples-for-inference" title="Permalink to this headline"></a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>splitset = Splitset.make(
    feature_ids = [feature.id]
    , label_id = None # Optional for unsupervised and pure inference.
)
</pre></div>
</div>
</section>
</section>
<section id="Reading-Splitsets">
<h4>Reading Splitsets<a class="headerlink" href="#Reading-Splitsets" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;train&#39;, &#39;validation&#39;, &#39;test&#39;])
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.keys()</span></code> of 1st layer are referred to as “split_name” in the source code: e.g. ‘train’ as well as, optionally, ‘validation’ and ‘test’.</p>
<p><code class="docutils literal notranslate"><span class="pre">Splitset.samples</span></code> on disk:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    &#39;train&#39;: [&lt;sample_indices&gt;],
    &#39;validation&#39;: [&lt;sample_indices&gt;],
    &#39;test&#39;: [&lt;sample_indices&gt;]
}
</pre></div>
</div>
<p>You can also verify the actual size of your splits.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">sizes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;validation&#39;: {&#39;percent&#39;: 0.12, &#39;count&#39;: 18},
 &#39;test&#39;: {&#39;percent&#39;: 0.2, &#39;count&#39;: 30},
 &#39;train&#39;: {&#39;percent&#39;: 0.68, &#39;count&#39;: 102}}
</pre></div></div>
</div>
<p>The main attribute of the splitset is the <code class="docutils literal notranslate"><span class="pre">samples</span></code> dictionary. Again, on-disk this only contains sample indices. The dictionary is structured like so:</p>
<hr class="docutils" />
</section>
</section>
<section id="c)-fold_count-triggers-cross-validation.">
<h3>c) <code class="docutils literal notranslate"><span class="pre">fold_count</span></code> triggers cross-validation.<a class="headerlink" href="#c)-fold_count-triggers-cross-validation." title="Permalink to this headline"></a></h3>
<section id="id10">
<h4>ORM<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h4>
<p>Reference the <a class="reference external" href="https://scikit-learn.org/stable/modules/cross_validation.html">scikit-learn documentation</a> to learn more about folding.</p>
<img alt="Cross Folds" src="../_images/cross_fold.png" />
<p>We refer to the left out fold (blue) as the <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> and the remaining training data as the <code class="docutils literal notranslate"><span class="pre">folds_train_combined</span></code> (green).</p>
</section>
<section id="Fold-objects">
<h4><code class="docutils literal notranslate"><span class="pre">Fold</span></code> objects<a class="headerlink" href="#Fold-objects" title="Permalink to this headline"></a></h4>
<p>For the sake of determining which samples get trained upon, the only thing that matters is the slice of data that gets left out.</p>
<blockquote>
<div><p>Tip - DO NOT use cross-validation unless your <em>(total sample count / fold_count)</em> still gives you an accurate representation of your sample population. If you are ignoring that advice and stretching to perform cross-validation, then at least ensure that <em>(total sample count / fold_count)</em> is evenly divisible. Both of these tips help avoid poorly stratified/ undersized folds that perform either too well (only most common label class present) or poorly (handful of samples and a few inaccurate
prediction on a normally good model).</p>
<p>Tip - The sample indices of the validation fold are not discarded. In fact, <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> can actually be used alongside a split <code class="docutils literal notranslate"><span class="pre">validation</span></code> for double validation 🤘. However, it’s more sensible to skip the validation split when cross-validating because you’ll want each <code class="docutils literal notranslate"><span class="pre">fold_validation</span></code> to be as large (representative of the population) as possible. Folds naturally have fewer samples, so a handful of incorrect predictions have the potential to offset your aggregate metrics.</p>
<p>Candidly, if you’ve ever performed cross-validation manually, let alone systematically, you’ll know that, barring stratification of continuous labels, it’s easy enough to construct the folds, but then it’s a pain to generate performance metrics (e.g. <code class="docutils literal notranslate"><span class="pre">zero_division</span></code>, absent OHE classes) due to the absence of outlying classes and bins. Time has been invested to handle these scenarios elegantly so that folds can be treated as first-class-citizens alongside splits. That being said, if you try
to do something undersized like “150 samples in their dataset and a <code class="docutils literal notranslate"><span class="pre">fold_count</span></code> &gt; 3 with <code class="docutils literal notranslate"><span class="pre">unique_classes</span></code> &gt; 4,” then you may run into edge cases.</p>
</div></blockquote>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">Splitset.samples</span></code>, there is a <code class="docutils literal notranslate"><span class="pre">Fold.samples</span></code> dictionary of sample indices with the following <code class="docutils literal notranslate"><span class="pre">.keys()</span></code>: * <code class="docutils literal notranslate"><span class="pre">samples['folds_train_combined']</span></code> - all the included folds. * <code class="docutils literal notranslate"><span class="pre">samples['fold_validation']</span></code> - the fold that got left out.</p>
<img alt="cross fold objects" src="../_images/cross_fold_objects.png" />
</section>
<section id="Specifying-Folds">
<h4>Specifying Folds<a class="headerlink" href="#Specifying-Folds" title="Permalink to this headline"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">big_label</span> <span class="o">=</span> <span class="n">Label</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="o">=</span><span class="n">big_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
<span class="n">big_fset</span> <span class="o">=</span> <span class="n">Feature</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="o">=</span><span class="n">big_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">exclude_columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_column</span><span class="p">])</span>
<span class="n">big_splits</span> <span class="o">=</span> <span class="n">Splitset</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">feature_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">big_fset</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">label_id</span> <span class="o">=</span> <span class="n">big_label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">size_test</span> <span class="o">=</span> <span class="mf">0.30</span>
    <span class="p">,</span> <span class="n">bin_count</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">,</span> <span class="n">fold_count</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">list</span><span class="p">(</span><span class="n">splitset</span><span class="o">.</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;Fold: 21&gt;, &lt;Fold: 22&gt;, &lt;Fold: 23&gt;, &lt;Fold: 24&gt;, &lt;Fold: 25&gt;]
</pre></div></div>
</div>
</section>
<section id="Reading-Folds">
<h4>Reading Folds<a class="headerlink" href="#Reading-Folds" title="Permalink to this headline"></a></h4>
<p>Sample indices of each Fold</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;folds_train_combined&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 3, 5, 6, 8, 10, 11, 13, 15]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">splitset</span><span class="o">.</span><span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;fold_validation&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[7, 9, 12, 26, 32, 33, 38, 52, 54, 58]
</pre></div></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>
<section id="4.-Preprocessing---Interpolation.">
<h2>4. Preprocessing - Interpolation.<a class="headerlink" href="#4.-Preprocessing---Interpolation." title="Permalink to this headline"></a></h2>
<section id="id11">
<h3>ORM<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h3>
<p>If you have columns with missing data in a time series, then interpolation allows you to fill in those blanks mathematically. It does so by fitting a curve to each column. If you don’t have time series data then you do not need interpolation.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.interpolate</span></code></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html</a></p>
<p>Is utilized due to its ease of use, variety of methods, and <strong>support of sparse indices</strong>. However, it does not follow the <code class="docutils literal notranslate"><span class="pre">fit/transform</span></code> pattern like many of the class-based sklearn preprocessors, so the interpolated training data is concatenated with the evalaution split during the interpolation of evaluation splits.</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">interpolate_kwargs:dict=None</span></code> object is what gets passed to Pandas interpolation. In my experience, <code class="docutils literal notranslate"><span class="pre">method=spline</span></code> produces the best results. However, if either spline cannot fit your data or you know that your pattern is linear, then try <code class="docutils literal notranslate"><span class="pre">method=linear</span></code>.</p>
<p>Here the default argument that will ultimately be used in <code class="docutils literal notranslate"><span class="pre">df.interpolate(**interpolate_kwargs)</span></code> if <code class="docutils literal notranslate"><span class="pre">interpolate_kwargs=None</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interpolate_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;spline&#39;</span>
    <span class="p">,</span> <span class="n">limit_direction</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
    <span class="p">,</span> <span class="n">limit_area</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="a)-Interpolate-Labels-with-LabelInterpolater.">
<h3>a) Interpolate Labels with <code class="docutils literal notranslate"><span class="pre">LabelInterpolater</span></code>.<a class="headerlink" href="#a)-Interpolate-Labels-with-LabelInterpolater." title="Permalink to this headline"></a></h3>
<p>Due to the fact that Labels cannot be windowed, LabelInterpolater simply fills in the gaps in a sequential progression.</p>
<p>In scenarios where evaluation splits may not have enough data to be interpretted individually, there is the <code class="docutils literal notranslate"><span class="pre">process_separately:bool=False</span></code> argument to fit across all splits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LabelInterpolater</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span>
    <span class="n">label_id</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">process_separately</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">,</span> <span class="n">interpolate_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spline&#39;</span>
        <span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>
        <span class="p">,</span> <span class="n">limit_area</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="b)-Interpolate-Features-with-Interpolaterset.">
<h3>b) Interpolate Features with <code class="docutils literal notranslate"><span class="pre">Interpolaterset</span></code>.<a class="headerlink" href="#b)-Interpolate-Features-with-Interpolaterset." title="Permalink to this headline"></a></h3>
<img alt="interpolate" src="../_images/interpolate_windows.png" />
<p>The fact that time series data is windowed presents challenges to preprocessing the training and evaluation splits/ folds separately in order to avoid leakage:</p>
<ul class="simple">
<li><p>For the 3D <code class="docutils literal notranslate"><span class="pre">Dataset.Sequence</span></code>, interpolation is simply ran separately on each 2D array.</p></li>
<li><p>However, for the 2D <code class="docutils literal notranslate"><span class="pre">Dataset.Tabular</span></code>, different windows belong to different splits/ folds so their underlying groups of rows must be interpolated separately.</p></li>
</ul>
<p>For <em>multivariate datasets</em> there are several columns/ dtypes in the data that can have completely different patterns/ curves to fit, so we need to be able to specify multiple interpolaters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FeatureInterpolater</span><span class="o">.</span><span class="n">from_feature</span><span class="p">(</span>
    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nox&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">interpolate_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span>
        <span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>
        <span class="p">,</span> <span class="n">limit_area</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">FeatureInterpolater</span><span class="o">.</span><span class="n">from_feature</span><span class="p">(</span>
    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">interpolate_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spline&#39;</span>
        <span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>
        <span class="p">,</span> <span class="n">limit_area</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="5.-Preprocessing---Encoding.">
<h2>5. Preprocessing - Encoding.<a class="headerlink" href="#5.-Preprocessing---Encoding." title="Permalink to this headline"></a></h2>
<section id="Encoding">
<h3>Encoding<a class="headerlink" href="#Encoding" title="Permalink to this headline"></a></h3>
<p>Certain algorithms either (a) require features and/ or labels formatted a certain way, or (b) perform significantly better when their values are normalized. For example:</p>
<ul class="simple">
<li><p>Scaling continuous features from (-1 to 1) or (0.0 to 1.0). Or transforming them to resemble a more Gaussian distribution.</p></li>
<li><p>Converting ordinal or categorical string data <code class="docutils literal notranslate"><span class="pre">[dog,</span> <span class="pre">cat,</span> <span class="pre">fish]</span></code> into one-hot encoded format <code class="docutils literal notranslate"><span class="pre">[[1,0,0][0,1,0][0,0,1]]</span></code>.</p></li>
</ul>
<p>There are two phases of encoding: 1. <code class="docutils literal notranslate"><span class="pre">fit</span></code> - where the encoder learns about the values of the samples made available to it. Ideally, you only want to <code class="docutils literal notranslate"><span class="pre">fit</span></code> aka learn from your training split so that you are not <em>“leaking”</em> information from your validation and test spits into your encoder! 2. <code class="docutils literal notranslate"><span class="pre">transform</span></code> - where the encoder transforms all of the samples in the population.</p>
<p>AIQC has solved the following challenges related to encoding:</p>
<ul class="simple">
<li><p>How does one dynamically <code class="docutils literal notranslate"><span class="pre">fit</span></code> on only the training samples in advanced scenarios like cross-validation where a different fold is used for validation each time?</p></li>
<li><p>For certain encoders, especially categorical ones, there is arguably no leakage. If an encoder is arbitrarilly assigning values/ tags to a sample through a process that is not aggregate-informed, then the information that is reveal to the <code class="docutils literal notranslate"><span class="pre">fit</span></code> is largely irrelevant. As an analogy, if we are examining swan color and all of a sudden there is a black swan… it’s clearly not white, so slap a non-white label on it and move on. In fact, the prediction process and performance metric calucatlion
may fail if it doesn’t know how to handle the previously unseen category.</p></li>
<li><p>Certain encoders only accept certain dtypes. Certain encoders only accept certain dimensionality (e.g. 1D, 2D, 3D) or shape patterns (odd-by-odd square). Unfortunately, there is not much uniformity here.</p></li>
<li><p>Certain encoders output extraneous objects that don’t work with deep learning libraries.</p></li>
</ul>
<blockquote>
<div><p>Only <code class="docutils literal notranslate"><span class="pre">sklearn.preprocessing</span></code> methods are officially supported, but we have experimented with <code class="docutils literal notranslate"><span class="pre">sklearn.feature_extraction.text.CountVectorizer</span></code></p>
</div></blockquote>
<hr class="docutils" />
</section>
<section id="a)-Encode-labels-with-LabelCoder.">
<h3>a) Encode labels with <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code>.<a class="headerlink" href="#a)-Encode-labels-with-LabelCoder." title="Permalink to this headline"></a></h3>
<p>Unfortunately, the name “LabelEncoder” is occupied by <code class="docutils literal notranslate"><span class="pre">sklearn.preprocessing.LabelEncoder</span></code></p>
<p>Of course, you cannot encode Labels if your <code class="docutils literal notranslate"><span class="pre">Splitset</span></code> does not have labels in the first place.</p>
<p>The process is straightforward. You provide an instantiated encoder [e.g. <code class="docutils literal notranslate"><span class="pre">StandardScaler()</span></code> not <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>], and then AIQC will:</p>
<ul class="simple">
<li><p>Verify that the encoder works with your <code class="docutils literal notranslate"><span class="pre">Label</span></code>’s dtype, sample values, and figure out what dimensionality it needs in order to succeed.</p></li>
<li><p>Automatically correct the attributes of your encoder to smooth out any common errors they would cause. For example, preventing the output of a sparse scipy matrix.</p></li>
<li><p>Determine whether the encoder should be <code class="docutils literal notranslate"><span class="pre">fit</span></code> either (a) exclusively on the train split, or (b) if it is not prone to leakage, inclusively on the entire dataset thereby reducing the chance of errors arising.</p></li>
</ul>
<section id="Creating-a-LabelCoder">
<h4>Creating a <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code><a class="headerlink" href="#Creating-a-LabelCoder" title="Permalink to this headline"></a></h4>
<p>AIQC only supports the uppercase <code class="docutils literal notranslate"><span class="pre">sklearn.preprocessing</span></code> methods (e.g. <code class="docutils literal notranslate"><span class="pre">RobustScaler</span></code>, but not <code class="docutils literal notranslate"><span class="pre">robust_scale</span></code>) because the lowercase methods do not separate the <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> steps. FYI, most of the uppercase methods have a combined <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> method if you need them.</p>
<blockquote>
<div><p><a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing">https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labelcoder</span> <span class="o">=</span> <span class="n">LabelCoder</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span>
    <span class="n">label_id</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sklearn_preprocess</span><span class="o">=</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The following method is used behind the scenes to fetch the most recently create LabelCoder for your Label when it comes time to encode data during training.</p>
<hr class="docutils" />
</section>
</section>
<section id="b)-Encode-Features-sequentially-with-FeatureCoders.">
<h3>b) Encode Features sequentially with <code class="docutils literal notranslate"><span class="pre">FeatureCoders</span></code>.<a class="headerlink" href="#b)-Encode-Features-sequentially-with-FeatureCoders." title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">FeatureCoder</span></code> has the same validation process as the <code class="docutils literal notranslate"><span class="pre">LabelCoder</span></code>. However, it is not without its own challenges:</p>
<ul class="simple">
<li><p>We want to be able to apply different encoders to columns of different dtypes.</p></li>
<li><p>Additionally, even within the same dtype (e.g. float/ continuous), different distributions call for different encoders.</p></li>
<li><p>Commonly used encoders such a <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> can ouput multiple columns from a single column input. Therefore, the <em>shape</em> of the features can change during encoding.</p></li>
<li><p>And finally, throughout this entire process, we need to avoid data leakage.</p></li>
</ul>
<p>For these reasons, <code class="docutils literal notranslate"><span class="pre">FeatureCoder</span></code>’s are applied sequentially; in an ordered chain, one after the other. After an encoder is applied, its columns are removed from the raw feature and placed into an intermediary cache specific to each split/ fold.</p>
<section id="Filtering-feature-columns">
<h4>Filtering feature columns<a class="headerlink" href="#Filtering-feature-columns" title="Permalink to this headline"></a></h4>
<p>The filtering mode is either:</p>
<ul class="simple">
<li><p>Inclusive (<code class="docutils literal notranslate"><span class="pre">include=True</span></code>) encode columns that match the filter.</p></li>
<li><p>Exclusive (<code class="docutils literal notranslate"><span class="pre">include=False</span></code>) encode columns outside of the filter.</p></li>
</ul>
<p>Then you can select:</p>
<ol class="arabic simple">
<li><p>An optional list of <code class="docutils literal notranslate"><span class="pre">dtypes</span></code>.</p></li>
<li><p>An optional list of <code class="docutils literal notranslate"><span class="pre">columns</span></code> name.</p></li>
</ol>
<ul class="simple">
<li><p>The column filter is applied after the dtype filter.</p></li>
</ul>
<blockquote>
<div><p>You can create a filter for all columns by setting <code class="docutils literal notranslate"><span class="pre">include=False</span></code> and then seting both <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div></blockquote>
<p>After submitting your encoder, if <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> is enabled: * The validation rules help determine why it may have failed. * The print statements help determine which columns your current filter matched, and which raw columns remain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">FeatureCoder</span> <span class="o">=</span> <span class="n">FeatureCoder</span><span class="o">.</span><span class="n">from_feature</span><span class="p">(</span>
    <span class="n">feature_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">sklearn_preprocess</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;yeo-johnson&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">,</span> <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

___/ featurecoder_index: 0 \_________

=&gt; The column(s) below matched your filter(s) featurecoder filters.

[&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;, &#39;petal_width&#39;]

=&gt; Done. All feature column(s) have featurecoder(s) associated with them.
No more FeatureCoders can be added to this Encoderset.

</pre></div></div>
</div>
<p>You can also view this information via the following attributes: <code class="docutils literal notranslate"><span class="pre">matching_columns</span></code>, <code class="docutils literal notranslate"><span class="pre">leftover_dtypes</span></code>, and <code class="docutils literal notranslate"><span class="pre">leftover_columns</span></code>.</p>
<hr class="docutils" />
</section>
</section>
</section>
<section id="6.-Preprocessing---Reshaping.">
<h2>6. Preprocessing - Reshaping.<a class="headerlink" href="#6.-Preprocessing---Reshaping." title="Permalink to this headline"></a></h2>
<section id="id12">
<h3>ORM<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h3>
<p>When working with architectures that are highly dimensional such convolutional and recurrent networks (Conv1D, Conv2D, Conv3D / ConvLSTM1D, ConvLSTM2D, ConvLSTM3D), you’ll often find yourself needing to reshape data to fit a layer’s required input shape.</p>
<p>AIQC ingestion &amp; preprocessing favors a <em>“channels_first”</em> (samples, channels, rows, columns) approach as opposed to <em>“channels_last”</em> (samples, rows, columns, channels).</p>
<ul class="simple">
<li><p><em>Reducing unused dimensions</em> - When working with grayscale/ single channel images (1 channel, 25 rows, 25 columns) there is no sense using Conv2D just to handle that 1 channel.</p></li>
<li><p><em>Adding wrapper dimensions</em> - Perhaps your data is a fit for ConvLSTM1D, but that layer is only supported in the nightly TensorFlow build so you want to add a wrapper dimension in order to use the production-ready ConvLSTM2D.</p></li>
</ul>
<p>It is difficult do this on the fly during training (aka after the fact) because you need to: add reshaping layers/ views to your model, intercept and reshape the data in your post-processing functions, and, by this point, the data is in a variety of tensor formats. It’s also more efficient to do this wrangling once up front rather than repeatedly on every training run.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">reshape_indices</span></code> argument accepts a tuple for rearranging indices in your order of choosing. Behind the scenes, it will use <code class="docutils literal notranslate"><span class="pre">np.reshape()</span></code> to rearrange the data at the end of your preprocessing pipeline. How the element is handled in that tuple is determined by its type.</p>
<p><code class="docutils literal notranslate"><span class="pre">feature.make_featureshaper(reshape_indices:tuple)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># source code from the end of `feature.preprocess()`</span>
<span class="n">current_shape</span> <span class="o">=</span> <span class="n">feature_array</span><span class="o">.</span><span class="n">shape</span>

<span class="n">new</span> <span class="n">shape</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">featureshaper</span><span class="o">.</span><span class="n">reshape_indices</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">new_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">new_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_shape</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">new_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
<span class="n">new_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>

<span class="n">feature_array</span> <span class="o">=</span> <span class="n">feature_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Warning:</em> if your model is unsupervised (aka generative or self-supervised), then it must output data in <em>“column (aka width) last”</em> shape. Otherwise, automated column decoding will be applied along the wrong dimension.</p>
</section>
<section id="Reshaping-by-Index">
<h3>Reshaping by Index<a class="headerlink" href="#Reshaping-by-Index" title="Permalink to this headline"></a></h3>
<p>Let’s say we have a 4D feature consisting of 3D images <code class="docutils literal notranslate"><span class="pre">(samples</span> <span class="pre">*</span> <span class="pre">color</span> <span class="pre">channels</span> <span class="pre">*</span> <span class="pre">rows</span> <span class="pre">*</span> <span class="pre">columns)</span></code>. Our image is B&amp;W, so we want to get rid of the single color channel. So we want to drop the dimension at the shape index <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reshape_indices</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Thus we have wrangled ourselves a 3D feature consisting of 2D images <code class="docutils literal notranslate"><span class="pre">(samples</span> <span class="pre">*</span> <span class="pre">rows</span> <span class="pre">*</span> <span class="pre">columns)</span></code>.</p>
</section>
<section id="Reshaping-Explicitly">
<h3>Reshaping Explicitly<a class="headerlink" href="#Reshaping-Explicitly" title="Permalink to this headline"></a></h3>
<p>But what if the dimensions we want cannot be expressed by rearranging the existing indices? You might have been wondering why <code class="docutils literal notranslate"><span class="pre">str</span></code> appeared in the loop above. If you define a string-based number, then that number will be used as directly as the value at that position.</p>
<p>So if I wanted to add an extra wrapper dimension to my data to serve as a single color channel, I would simply do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reshape_indices</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="Multiplicative-Reshaping">
<h3>Multiplicative Reshaping<a class="headerlink" href="#Multiplicative-Reshaping" title="Permalink to this headline"></a></h3>
<p>Sometimes you need to stack/nest dimensions. This requires multiplying one shape index by another. For example, if I have a 3 separate hours worth of data and I want to treat it as 180 minutes, then I need to go from a shape of (3 hours * 60 minutes) to (180 minutes). Just provide the shape indices that you want to multiply in a <code class="docutils literal notranslate"><span class="pre">tuple</span></code> like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reshape_indices</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="7.-Defining-Architectures-&amp;-Hyperparameters.">
<h2>7. Defining Architectures &amp; Hyperparameters.<a class="headerlink" href="#7.-Defining-Architectures-&-Hyperparameters." title="Permalink to this headline"></a></h2>
<section id="a)-Define-an-Algorithm">
<h3>a) Define an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code><a class="headerlink" href="#a)-Define-an-Algorithm" title="Permalink to this headline"></a></h3>
<p>Now that our data has been prepared, we transition to the other half of the ORM where the focus is the logic that will be applied to that data.</p>
<blockquote>
<div><p>An <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> is our ORM’s codename for a machine learning model since <em>Model</em> is the most important <em>reserved word</em> when it comes to ORMs.</p>
</div></blockquote>
<p>The following attributes tell AIQC how to handle the Algorithm behind the scenes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">library</span></code> - right now, only ‘keras’ is supported.</p>
<ul>
<li><p>Each library’s model object and callbacks (history, early stopping) need to be handled differently.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">analysis_type</span></code> - right now, these types are supported:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'classification_multi'</span></code>, <code class="docutils literal notranslate"><span class="pre">'classification_binary'</span></code>, <code class="docutils literal notranslate"><span class="pre">'regression'</span></code>.</p></li>
<li><p>Used to determine which performance metrics to run.</p></li>
<li><p>Must be compatible with the type of label fed to it.</p></li>
</ul>
</li>
</ul>
<section id="Model-Definition">
<h4>Model Definition<a class="headerlink" href="#Model-Definition" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> is composed of the functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fn_build</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_lose</span></code> (optional, inferred).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> (optional, inferred).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_train</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_predict</span></code> (optional, inferred).</p></li>
</ul>
<blockquote>
<div><p>May provide overridable defaults for build and train in the future.</p>
</div></blockquote>
<p>You can name the functions whatever you want, but do not change the predetermined arguments (e.g. <code class="docutils literal notranslate"><span class="pre">input_shape</span></code>,<code class="docutils literal notranslate"><span class="pre">**hp</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, etc.) or their position.</p>
<p>As we define these functions, we’ll see that we can pass a dictionary of <em>hyperparameters</em> into these function using the <code class="docutils literal notranslate"><span class="pre">**hp</span></code> kwarg, and access them like so: <code class="docutils literal notranslate"><span class="pre">hp['&lt;some_variable_name&gt;']</span></code>. Later, we’ll provide a list of values for each entry in the hyperparameters dictionary.</p>
<p>Let’s import the modules that we need.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow.keras.layers</span> <span class="k">as</span> <span class="nn">layers</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>Later, when running your <code class="docutils literal notranslate"><span class="pre">Job</span></code>’s, if you receive a “module not found” error, then you can try troubleshooting by importing that module directly within the function where it is used.</p>
</div></blockquote>
<hr class="docutils" />
<section id="└──-fn_build">
<h5>└── <code class="docutils literal notranslate"><span class="pre">fn_build</span></code><a class="headerlink" href="#└──-fn_build" title="Permalink to this headline"></a></h5>
<p>You can build your topology however you like, just be sure to <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">model</span></code>. Also, you don’t have to use any of the hyperparameters (<code class="docutils literal notranslate"><span class="pre">**hp</span></code>) if you don’t want to.</p>
<p>The automatically provided <code class="docutils literal notranslate"><span class="pre">features_shape</span></code> and <code class="docutils literal notranslate"><span class="pre">label_shape</span></code> are handy because:</p>
<ul class="simple">
<li><p>The number of feature/ label columns is mutable due to encoders (e.g. OHE).</p></li>
<li><p>Shapes can be less obvious in multi-dimensional scenarios like colored images.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_build</span><span class="p">(</span><span class="n">features_shape</span><span class="p">,</span> <span class="n">label_shape</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;neuron_count&#39;</span><span class="p">],</span> <span class="n">input_shape</span><span class="o">=</span><span class="n">features_shape</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;he_uniform&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="s1">&#39;neuron_count&#39;</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">&#39;he_uniform&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">label_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="└──-fn_lose-(optional)">
<h5>└── <code class="docutils literal notranslate"><span class="pre">fn_lose</span></code> (optional)<a class="headerlink" href="#└──-fn_lose-(optional)" title="Permalink to this headline"></a></h5>
<p>We can’t just specify the loss function in our training loop because we will need it later on when it comes time to produce metrics about other splits/ folds.</p>
<p>If you do not provide an <code class="docutils literal notranslate"><span class="pre">fn_lose</span></code> then one will be automatically selected for you based on the <code class="docutils literal notranslate"><span class="pre">Algorithm.analysis_type</span></code> you are conducting and the <code class="docutils literal notranslate"><span class="pre">Algorithm.library</span></code> you are using.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_lose</span><span class="p">(</span><span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">loser</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">CategoricalCrossentropy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">loser</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="└──-fn_optimize-(optional)">
<h5>└── <code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> (optional)<a class="headerlink" href="#└──-fn_optimize-(optional)" title="Permalink to this headline"></a></h5>
<p>Some deep learning libraries persist their model and optimizer separately during checkpoint/exporting. So <code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> provides an isolated way to access the optimizer. It also allows us to automatically set the optimizer.</p>
<p>If you do not provide an <code class="docutils literal notranslate"><span class="pre">fn_optimize</span></code> then one will be automatically selected for you based on the <code class="docutils literal notranslate"><span class="pre">Algorithm.analysis_type</span></code> you are conducting and the <code class="docutils literal notranslate"><span class="pre">Algorithm.library</span></code> you are using.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_optimize</span><span class="p">(</span><span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adamax</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">optimizer</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>If you want to define your own optimizer, then you should do so within this function, rather than relying on <code class="docutils literal notranslate"><span class="pre">model.compile(optimizer='&lt;some_optimizer_name&gt;'</span></code>. If you do not define an optimizer, then <code class="docutils literal notranslate"><span class="pre">Adamax</span></code> will be used by default.</p>
</div></blockquote>
<hr class="docutils" />
</section>
<section id="└──-fn_train">
<h5>└── <code class="docutils literal notranslate"><span class="pre">fn_train</span></code><a class="headerlink" href="#└──-fn_train" title="Permalink to this headline"></a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples_train</span></code> - the appropriate data will be fed into the training cycle. For example, <code class="docutils literal notranslate"><span class="pre">Fold.samples[fold_index]['folds_train_combined']</span></code> or <code class="docutils literal notranslate"><span class="pre">Splitset.samples['train']</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_evaluate</span></code> - the appropriate data is made available for evaluation. For example, <code class="docutils literal notranslate"><span class="pre">Fold.samples[fold_index]['fold_validation']</span></code>, <code class="docutils literal notranslate"><span class="pre">Splitset.samples['validation']</span></code>, or <code class="docutils literal notranslate"><span class="pre">Splitset.samples['test']</span></code>.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_train</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">loser</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span>
    <span class="n">train_features</span><span class="p">,</span> <span class="n">train_label</span><span class="p">,</span>
    <span class="n">eval_features</span><span class="p">,</span> <span class="n">eval_label</span><span class="p">,</span>
    <span class="o">**</span><span class="n">hp</span>
<span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span>        <span class="o">=</span> <span class="n">loser</span>
        <span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="p">,</span> <span class="n">metrics</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">train_features</span><span class="p">,</span> <span class="n">train_label</span><span class="p">,</span>
        <span class="p">,</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">eval_features</span><span class="p">,</span> <span class="n">eval_label</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">verbose</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="n">batch_size</span>      <span class="o">=</span> <span class="mi">3</span>
        <span class="p">,</span> <span class="n">epochs</span>          <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;epoch_count&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">callbacks</span>       <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">History</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="Training-loop">
<h5>Training loop<a class="headerlink" href="#Training-loop" title="Permalink to this headline"></a></h5>
<ul class="simple">
<li><p>TensorFlow: either write a custom loop or use Keras.</p></li>
<li><p>PyTorch: either write a custom loop or use AIQC’s <code class="docutils literal notranslate"><span class="pre">utils.pytorch.fit</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span><span class="nb">object</span>
    <span class="p">,</span> <span class="n">loser</span><span class="p">:</span><span class="nb">object</span>
    <span class="p">,</span> <span class="n">optimizer</span><span class="p">:</span><span class="nb">object</span>

    <span class="p">,</span> <span class="n">train_features</span><span class="p">:</span><span class="nb">object</span>
    <span class="p">,</span> <span class="n">train_label</span><span class="p">:</span><span class="nb">object</span>
    <span class="p">,</span> <span class="n">eval_features</span><span class="p">:</span><span class="nb">object</span>
    <span class="p">,</span> <span class="n">eval_label</span><span class="p">:</span><span class="nb">object</span>

    <span class="p">,</span> <span class="n">epochs</span><span class="p">:</span><span class="nb">int</span>              <span class="o">=</span> <span class="mi">30</span>
    <span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span><span class="nb">int</span>          <span class="o">=</span> <span class="mi">5</span>
    <span class="p">,</span> <span class="n">enforce_sameSize</span><span class="p">:</span><span class="nb">bool</span>   <span class="o">=</span> <span class="kc">True</span>
    <span class="p">,</span> <span class="n">allow_singleSample</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">,</span> <span class="n">metrics</span><span class="p">:</span><span class="nb">list</span>            <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>enforce_sameSize</em></p></td>
<td><p>removes the last batch if it is a different size</p></td>
</tr>
<tr class="row-odd"><td><p><em>allow_singleSample</em></p></td>
<td><p>errors if a batch only contains 1 sample, which often leads to layer errors during training</p></td>
</tr>
<tr class="row-even"><td><p><em>metrics</em></p></td>
<td><p>instantiated <code class="docutils literal notranslate"><span class="pre">torchmetrics</span></code> classes e.g. <code class="docutils literal notranslate"><span class="pre">Accuracy</span></code></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="Customizable-history">
<h5>Customizable history<a class="headerlink" href="#Customizable-history" title="Permalink to this headline"></a></h5>
<p>The goal of the <code class="docutils literal notranslate"><span class="pre">Predictor.history</span></code> object is to record the training and evaluation metrics at the end of each epic so that they can be interpretted in the learning curve plots. Reference the <a class="reference external" href="visualization.html">visualization</a> section.</p>
<ul class="simple">
<li><p><em>Keras</em>: any <code class="docutils literal notranslate"><span class="pre">metrics=[]</span></code> specified are automatically added to the <code class="docutils literal notranslate"><span class="pre">History</span></code> callback object.</p></li>
<li><p><em>PyTorch</em>: users are responsible for calculating their own metrics (we recommend the <code class="docutils literal notranslate"><span class="pre">torchmetrics</span></code> package) and placing them into a <code class="docutils literal notranslate"><span class="pre">history</span></code> dictionary that mirrors the schema of the Keras history object. Reference the torch <a class="reference external" href="gallery/pytorch/multi_class.html">examples</a>.</p></li>
</ul>
<blockquote>
<div><p>The schema of this dictionary is as follows: <code class="docutils literal notranslate"><span class="pre">dict(*:ndarray,</span> <span class="pre">val_*=ndarray)</span></code>. For example, if you wanted to record the history of the ‘loss’ and ‘accuracy’ metrics manually for PyTorch, you would construct it like so:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">val_loss</span><span class="o">=</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">accuracy</span><span class="o">=</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">val_accuracy</span><span class="o">=</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="Optional,-callback-to-stop-training-early.">
<h5>Optional, callback to stop training early.<a class="headerlink" href="#Optional,-callback-to-stop-training-early." title="Permalink to this headline"></a></h5>
<p><em>Early stopping</em> isn’t just about efficiency in reducing the number of <code class="docutils literal notranslate"><span class="pre">epochs</span></code>. If you’ve specified 300 epochs, there’s a chance your model catches on to the underlying patterns early, say around 75-125 epochs. At this point, there’s also good chance what it learns in the remaining epochs will cause it to overfit on patterns that are specific to the training data, and thereby and lose it’s simplicity/ generalizability.</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">val_</span></code> prefix refers to the evaluation samples.</p>
<p>Remember, regression does not have accuracy metrics.</p>
<p><code class="docutils literal notranslate"><span class="pre">TrainingCallback.MetricCutoff</span></code> is a custom class we wrote to make <em>early stopping</em> easier, so you won’t find information about it in the official Keras documentation.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">aiqc.utils.tensorflow</span> <span class="kn">import</span> <span class="n">TrainingCallback</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loser</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">samples_train</span><span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">,</span> <span class="o">**</span><span class="n">hp</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loser</span>
        <span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1">#Define one or more metrics to monitor.</span>
    <span class="n">metrics_cuttoffs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span><span class="mf">0.96</span><span class="p">,</span> <span class="s2">&quot;above_or_below&quot;</span><span class="p">:</span><span class="s2">&quot;above&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;above_or_below&quot;</span><span class="p">:</span><span class="s2">&quot;below&quot;</span><span class="p">}</span>
    <span class="p">]</span>
    <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">TrainingCallback</span><span class="o">.</span><span class="n">MetricCutoff</span><span class="p">(</span><span class="n">metrics_cuttoffs</span><span class="p">)</span>
    <span class="c1"># Remember to append `cutoffs` to the list of callbacks.</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">History</span><span class="p">(),</span> <span class="n">cutoffs</span><span class="p">]</span>

    <span class="c1"># No changes here.</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">samples_train</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">samples_evaluate</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="s1">&#39;epoch_count&#39;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="└──-fn_predict-(optional)">
<h5>└── <code class="docutils literal notranslate"><span class="pre">fn_predict</span></code> (optional)<a class="headerlink" href="#└──-fn_predict-(optional)" title="Permalink to this headline"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">fn_predict</span></code> will be generated for you automatically if set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. The <code class="docutils literal notranslate"><span class="pre">analysis_type</span></code> and <code class="docutils literal notranslate"><span class="pre">library</span></code> of the Algorithm help determine how to handle the predictions.</p>
<ol class="lowerroman simple">
<li><p>Regression default.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
<ol class="lowerroman simple" start="2">
<li><p>Classification binary default.</p></li>
</ol>
<p>All classification <code class="docutils literal notranslate"><span class="pre">predictions</span></code>, both mutliclass and binary, must be returned in ordinal format.</p>
<blockquote>
<div><p>For most libraries, classification algorithms output <em>probabilities</em> as opposed to actual predictions when running <code class="docutils literal notranslate"><span class="pre">model.predict()</span></code>. We want to return both of these object <code class="docutils literal notranslate"><span class="pre">predictions,</span> <span class="pre">probabilities</span></code> (the order matters) to generate performance metrics behind the scenes.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="c1"># This is the official keras replacement for binary classes `.predict_classes()`</span>
    <span class="c1"># It returns one array per sample: `[[0][1][0][1]]`</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">probabilities</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</pre></div>
</div>
</div>
<ol class="lowerroman simple" start="3">
<li><p>Classification multiclass default.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fn_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples_predict</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples_predict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="c1"># This is the official keras replacement for multiclass `.predict_classes()`</span>
    <span class="c1"># It returns one ordinal array per sample: `[[0][2][1][2]]`</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="Group-the-functions-together-in-an-Algorithm!">
<h4>Group the functions together in an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code>!<a class="headerlink" href="#Group-the-functions-together-in-an-Algorithm!" title="Permalink to this headline"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">Algorithm</span><span class="o">.</span><span class="n">make</span><span class="p">(</span>
    <span class="n">library</span> <span class="o">=</span> <span class="s2">&quot;keras&quot;</span>
    <span class="p">,</span> <span class="n">analysis_type</span> <span class="o">=</span> <span class="s2">&quot;classification_multi&quot;</span>
    <span class="p">,</span> <span class="n">fn_build</span> <span class="o">=</span> <span class="n">fn_build</span>
    <span class="p">,</span> <span class="n">fn_train</span> <span class="o">=</span> <span class="n">fn_train</span>
    <span class="p">,</span> <span class="n">fn_optimize</span> <span class="o">=</span> <span class="n">fn_optimize</span> <span class="c1"># Optional</span>
    <span class="p">,</span> <span class="n">fn_predict</span> <span class="o">=</span> <span class="n">fn_predict</span> <span class="c1"># Optional</span>
    <span class="p">,</span> <span class="n">fn_lose</span> <span class="o">=</span> <span class="n">fn_lose</span> <span class="c1"># Optional</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>&lt;!&gt; Remember to use <code class="docutils literal notranslate"><span class="pre">make</span></code> and not <code class="docutils literal notranslate"><span class="pre">create</span></code>. Deceptively, <code class="docutils literal notranslate"><span class="pre">create</span></code> exists because it is a standard, built-in ORM method. However, it does so without any validation logic.</p>
</div></blockquote>
<hr class="docutils" />
</section>
</section>
<section id="b)-Combinations-of-hyperparameters-with-Hyperparamset.">
<h3>b) Combinations of hyperparameters with <code class="docutils literal notranslate"><span class="pre">Hyperparamset</span></code>.<a class="headerlink" href="#b)-Combinations-of-hyperparameters-with-Hyperparamset." title="Permalink to this headline"></a></h3>
<p>Parameters are fed into Algorithm functions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hyperparameters</span></code> below will be automatically fed into the functions above as <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> via the <code class="docutils literal notranslate"><span class="pre">**hp</span></code> argument we saw earlier.</p>
<p>For example, wherever you see <code class="docutils literal notranslate"><span class="pre">hp['epoch_count']</span></code>, it will pull from the <em>key:value</em> pair <code class="docutils literal notranslate"><span class="pre">&quot;epoch_count&quot;:</span> <span class="pre">[30,</span> <span class="pre">60]</span></code> seen below. Where “model A” would have 30 epochs and “model B” would have 60 epochs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">neuron_count</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">epoch_count</span>   <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">learning_rate</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<section id="Hyperparameter-Selection-Strategies.">
<h4>Hyperparameter Selection Strategies.<a class="headerlink" href="#Hyperparameter-Selection-Strategies." title="Permalink to this headline"></a></h4>
<section id="Grid-search-strategy.">
<h5>Grid search strategy.<a class="headerlink" href="#Grid-search-strategy." title="Permalink to this headline"></a></h5>
<p>By default AIQC will generate all possible combinations.</p>
<blockquote>
<div><p>With enough practice, practitioners will get a feel for what parameters and topologies make sense so you’ll rely on shotgun-style approaches less and less. If you limit your experiments to 1-2 parameters at a time then it’s easy to see their effect as an <em>independent variable</em>. You should really start with high-level things such as topologies (# of layers, # neurons per layer) and batch size before moving on to tuning the intra-layer nuances (activation methods, weight initialization). You’re
essentially testing high/ medium/ low or default/ edge case scenarios for each parameter.</p>
</div></blockquote>
</section>
<section id="Random-selection-strategy.">
<h5>Random selection strategy.<a class="headerlink" href="#Random-selection-strategy." title="Permalink to this headline"></a></h5>
<p>Testing many different combinations in your initial runs can be a good way to get a feel for the parameter space. Although if you are doing this you’ll find that many of your combinations are a bit too similar. So randomly sampling (with replacement) a few of them is a less computationally expensive way to go about this.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">search_count:int</span></code> the fixed # of combinations to sample.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_percent:float</span></code> a % of combinations to sample.</p></li>
</ul>
</section>
<section id="Bayesian-selection-strategy.">
<h5>Bayesian selection strategy.<a class="headerlink" href="#Bayesian-selection-strategy." title="Permalink to this headline"></a></h5>
<p>“TPE (Tree-structured Parzen Estimator)” via <code class="docutils literal notranslate"><span class="pre">hyperopt</span></code> has been suggested as a future area to explore.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamset</span> <span class="o">=</span> <span class="n">Hyperparamset</span><span class="o">.</span><span class="n">from_algorithm</span><span class="p">(</span>
    <span class="n">algorithm_id</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
    <span class="p">,</span> <span class="n">search_count</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">,</span> <span class="n">search_percent</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="Hyperparamcombo-objects.">
<h4><code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code> objects.<a class="headerlink" href="#Hyperparamcombo-objects." title="Permalink to this headline"></a></h4>
<p>Each unique combination of hyperparameters is recorded as a <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code>.</p>
<p>Ultimately, a training <code class="docutils literal notranslate"><span class="pre">Job</span></code> is constructed for each unique combinanation of hyperparameters aka <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamset</span><span class="o">.</span><span class="n">hyperparamcombo_count</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hyperparamset</span><span class="o">.</span><span class="n">hyperparamcombos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">(</span><span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>param</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>neuron_count</td>
      <td>12.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>epoch_count</td>
      <td>30.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>learning_rate</td>
      <td>0.01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>
<section id="8.-Queue-of-training-Jobs.">
<h2>8. <code class="docutils literal notranslate"><span class="pre">Queue</span></code> of training <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.<a class="headerlink" href="#8.-Queue-of-training-Jobs." title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Queue</span></code> is the central object of the “logic side” of the ORM. It ties together everything we need for training and hyperparameter tuning.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">from_algorithm</span><span class="p">(</span>
    <span class="n">algorithm_id</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">splitset_id</span> <span class="o">=</span> <span class="n">splitset</span><span class="o">.</span><span class="n">id</span>
    <span class="p">,</span> <span class="n">hyperparamset_id</span> <span class="o">=</span> <span class="n">hyperparamset</span><span class="o">.</span><span class="n">id</span> <span class="c1"># Optional.</span>
    <span class="p">,</span> <span class="n">repeat_count</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">,</span> <span class="n">permute_count</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">repeat_count:int=1</span></code> allows us to run the same <code class="docutils literal notranslate"><span class="pre">Job</span></code> multiple times. Normally, each <code class="docutils literal notranslate"><span class="pre">Job</span></code> has 1 <code class="docutils literal notranslate"><span class="pre">Predictor</span></code> associated with it upon completion. However, when <code class="docutils literal notranslate"><span class="pre">repeat_count</span></code> (&gt; 1 of course) is used, a single <code class="docutils literal notranslate"><span class="pre">Job</span></code> will have multiple <code class="docutils literal notranslate"><span class="pre">Predictors</span></code>.</p></li>
</ul>
<blockquote>
<div><p>Due to the fact that training is a <em>nondeterministic</em> process, we get different weights each time we train a model, even if we use the same set of parameters. Perhaps you’ve have the right topology and parameters, but, this time around, the model just didn’t recgonize the patterns. Similar to flipping a coin, there is a degree of chance in it, but the real trend averages out upon repetition.</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hide_test:bool=False</span></code> excludes the test split from the performance metrics and visualizations. This avoids data leakage by forcing the user to make decisions based on the performance on their model on the training and evaluation samples.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">permute_count:int=3</span></code> controls the number of times each feature column is shuffled before it’s impact on loss is compared to the baseline training loss before the median taken. Feature importance is calculated for each column of each <code class="docutils literal notranslate"><span class="pre">Feature.id</span></code>, except for <code class="docutils literal notranslate"><span class="pre">Feature.dataset.dataset_type=='image'</span></code>. If you have many columns and all you care about is the final prediction, then it may make sense to set <code class="docutils literal notranslate"><span class="pre">permute_count=0</span></code> because permutations are computationally expensive &amp; difficult to
parallelize.</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">[training</span> <span class="pre">loss</span> <span class="pre">-</span> <span class="pre">(median</span> <span class="pre">loss</span> <span class="pre">of</span> <span class="pre">&lt;5&gt;</span> <span class="pre">permutations)]</span></code></p>
</div></blockquote>
<hr class="docutils" />
<section id="a)-Job-objects.">
<h3>a) <code class="docutils literal notranslate"><span class="pre">Job</span></code> objects.<a class="headerlink" href="#a)-Job-objects." title="Permalink to this headline"></a></h3>
<p>Each <code class="docutils literal notranslate"><span class="pre">Job</span></code> in the Queue represents a <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo</span></code> that needs to be trained.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">Splitset.fold_count</span></code> was specified, then:</p>
<ul class="simple">
<li><p>The number of jobs = <code class="docutils literal notranslate"><span class="pre">hyperparamcombo_count</span></code> * <code class="docutils literal notranslate"><span class="pre">fold_count</span></code>.</p></li>
<li><p>Each Job will have a <code class="docutils literal notranslate"><span class="pre">Fold</span></code>.</p></li>
</ul>
<hr class="docutils" />
</section>
<section id="b)-Executing-Jobs.">
<h3>b) Executing <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>.<a class="headerlink" href="#b)-Executing-Jobs." title="Permalink to this headline"></a></h3>
<p>There are two ways to execute a Queue of Jobs:</p>
<section id="i)-queue.run_jobs()">
<h4>i) <code class="docutils literal notranslate"><span class="pre">queue.run_jobs()</span></code><a class="headerlink" href="#i)-queue.run_jobs()" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>Jobs are simply ran on a loop on the main <em>Process</em>.</p></li>
<li><p>Stop the Jobs with a keyboard interrupt e.g. <code class="docutils literal notranslate"><span class="pre">ctrl+Z/D/C</span></code> in Python shell or <code class="docutils literal notranslate"><span class="pre">i,i</span></code> in Jupyter.</p></li>
<li><p>It is the more reliable approach on Win/Mac/Lin.</p></li>
<li><p>Although this locks your main process (can’t write more code) while models train, you can still fire up a second shell session or notebook.</p></li>
<li><p>Prototype your training jobs in this method so that you can see any errors that arise in the console.</p></li>
</ul>
</section>
<section id="ii)-DEPRECATED---queue.run_jobs(in_background=True).">
<h4>ii) DEPRECATED - <code class="docutils literal notranslate"><span class="pre">queue.run_jobs(in_background=True)</span></code>.<a class="headerlink" href="#ii)-DEPRECATED---queue.run_jobs(in_background=True)." title="Permalink to this headline"></a></h4>
<p><em>Support for background processing has not been restored after decoupling the preprocessing pipelines from the Queue/Job logic.</em></p>
<ul class="simple">
<li><p>The Jobs loop is executed on a separate, parallel <code class="docutils literal notranslate"><span class="pre">multiprocessing.Process</span></code></p></li>
<li><p>Stop the Jobs with <code class="docutils literal notranslate"><span class="pre">queue.stop_jobs()</span></code> (also deprecated), which kills the parallel <em>Process</em> unless it already failed.</p></li>
<li><p>The benefit is that you can continue to code while your models are trained. There is no performance boost.</p></li>
<li><p>On Mac and Linux (Unix), <code class="docutils literal notranslate"><span class="pre">'fork'</span></code> multiprocessing is used (<code class="docutils literal notranslate"><span class="pre">force=True</span></code>), which allows us to display the progress bar. FYI, even in ‘fork’ mode, Python multiprocessing is much more fragile in Python 3.8, which seems to be caused by how pickling is handled in passing variables to the child process.</p></li>
<li><p>On Windows, <code class="docutils literal notranslate"><span class="pre">'spawn'</span></code> multiprocessing is used, which requires polling:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">queue.poll_statuses()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queue.poll_progress(raw:bool=False,</span> <span class="pre">loop:bool=False,</span> <span class="pre">loop_delay:int=3)</span></code> where <code class="docutils literal notranslate"><span class="pre">raw=True</span></code> is just a float, <code class="docutils literal notranslate"><span class="pre">loop=True</span></code> won’t stop checking jobs until they are all complete, and <code class="docutils literal notranslate"><span class="pre">loop_delay=3</span></code> checks the progress every 3 seconds.</p></li>
</ul>
</li>
<li><p>Also, during stress tests, I observed that when running multiple queues at the same time, the SQLite database would lock when simultaneous writes were attempted.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">queue</span><span class="o">.</span><span class="n">run_jobs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
🔮 Training Models 🔮: 100%|████████████████████████████████████████| 12/12 [00:49&lt;00:00,  4.12s/it]
</pre></div></div>
</div>
<p>The queue is interuptable. You can stop the execution of a queue and resume it later.</p>
<blockquote>
<div><p>This also comes in handy if either your machine or Python kernel either crashes or are interupted by accident. Whatever the reason, rest easy, just <code class="docutils literal notranslate"><span class="pre">run_jobs()</span></code> again to pick up where you left off. Be aware that the <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> iteration time in the progress bar will be wrong because it will be divided by the jobs already ran.</p>
</div></blockquote>
<hr class="docutils" />
<section id="Preprocessing-during-Job-is-recorded">
<h5>Preprocessing during Job is recorded<a class="headerlink" href="#Preprocessing-during-Job-is-recorded" title="Permalink to this headline"></a></h5>
<p>During the execution of a Job, the LabelCoder and FeatureCoders(s) tied to the Label and Feature(s) of the Splitset used during training will record their <code class="docutils literal notranslate"><span class="pre">fit()</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FittedLabelCoder</span></code> for the LabelCoder used.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fitted_encoders:object</span></code> to store the <code class="docutils literal notranslate"><span class="pre">fit</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FittedEncoderset</span></code> for each Feature used.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fitted_encoders:list</span></code> to store the <code class="docutils literal notranslate"><span class="pre">fit</span></code>(s).</p></li>
</ul>
</li>
</ul>
<p>This process is critical for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inverse_transform()</span></code>’ing aka decoding predictions.</p></li>
<li><p>Encoding new data during inference exactly the same was as the samples that the model was trained on.</p></li>
</ul>
<p>It takes a lot of joins to fetch the fitted encoders after the fact. So these methods are used behind the scenes to make it a bit easier:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Predictor.get_fitted_encoders(job,</span> <span class="pre">label)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Predictor.get_fitted_LabelCoder(job,</span> <span class="pre">feature)</span></code></p></li>
</ul>
<hr class="docutils" />
</section>
</section>
</section>
<section id="c)-Predictors-are-the-trained-models.">
<h3>c) <code class="docutils literal notranslate"><span class="pre">Predictors</span></code> are the trained models.<a class="headerlink" href="#c)-Predictors-are-the-trained-models." title="Permalink to this headline"></a></h3>
<p>Each <code class="docutils literal notranslate"><span class="pre">Job</span></code> trains a <code class="docutils literal notranslate"><span class="pre">Predictor</span></code>. The following attributes are automatically written to the <code class="docutils literal notranslate"><span class="pre">Predictor</span></code> after training.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code>: serialization varies for Keras and Pytorch deep learning framework.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_shapes</span></code>: used by <code class="docutils literal notranslate"><span class="pre">get_model()</span></code> during inference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">history</span></code>: per epoch metrics recorded during training.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictor</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">predictors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<section id="Fetching-the-trained-model.">
<h4>Fetching the trained model.<a class="headerlink" href="#Fetching-the-trained-model." title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictor</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;keras.engine.sequential.Sequential at 0x18227fe90&gt;
</pre></div></div>
</div>
</section>
<section id="Fetching-the-hyperparameters.">
<h4>Fetching the hyperparameters.<a class="headerlink" href="#Fetching-the-hyperparameters." title="Permalink to this headline"></a></h4>
<p>This method is just a proxy that passes argments to <code class="docutils literal notranslate"><span class="pre">Hyperparamcombo.get_hyperparameters()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictor</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">(</span><span class="n">as_pandas</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="d)-Predictions-are-the-output-of-a-Predictor.">
<h3>d) <code class="docutils literal notranslate"><span class="pre">Predictions</span></code> are the output of a Predictor.<a class="headerlink" href="#d)-Predictions-are-the-output-of-a-Predictor." title="Permalink to this headline"></a></h3>
<p>When you feed samples through a Predictor, you get Predictions. During training, Predictions are automatically generated for every split/fold that was tied to the Queue.</p>
<section id="Fetching-metrics.">
<h4>Fetching metrics.<a class="headerlink" href="#Fetching-metrics." title="Permalink to this headline"></a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>predictions</em></p></td>
<td><p>decoded predictions ndarray for per split/ fold/ inference</p></td>
</tr>
<tr class="row-odd"><td><p><em>feature_importance</em></p></td>
<td><p>importance of each column. only for training split/fold</p></td>
</tr>
<tr class="row-even"><td><p><em>probabilities</em></p></td>
<td><p>prediction probabilities per split/ fold. <code class="docutils literal notranslate"><span class="pre">None</span></code> for regression.</p></td>
</tr>
<tr class="row-odd"><td><p><em>metrics</em></p></td>
<td><p>statistics for each split/fold that vary based on the analysis_type.</p></td>
</tr>
<tr class="row-even"><td><p><em>metrics_aggregate</em></p></td>
<td><p>average for each statistic across all splits/folds.</p></td>
</tr>
<tr class="row-odd"><td><p><em>plot_data</em></p></td>
<td><p>metrics reformatted for plot functions.</p></td>
</tr>
</tbody>
</table>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">queue</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">predictors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metrics</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train&#39;: {&#39;accuracy&#39;: 0.9607843137254902,
  &#39;f1&#39;: 0.9607503607503607,
  &#39;loss&#39;: 0.08033698052167892,
  &#39;precision&#39;: 0.9618055555555555,
  &#39;recall&#39;: 0.9607843137254902,
  &#39;roc_auc&#39;: 0.9985582468281432},
 &#39;validation&#39;: {&#39;accuracy&#39;: 0.9444444444444444,
  &#39;f1&#39;: 0.9440559440559441,
  &#39;loss&#39;: 0.13840313255786896,
  &#39;precision&#39;: 0.9523809523809523,
  &#39;recall&#39;: 0.9444444444444444,
  &#39;roc_auc&#39;: 1.0},
 &#39;test&#39;: {&#39;accuracy&#39;: 0.9333333333333333,
  &#39;f1&#39;: 0.9333333333333333,
  &#39;loss&#39;: 0.1355634480714798,
  &#39;precision&#39;: 0.9333333333333333,
  &#39;recall&#39;: 0.9333333333333333,
  &#39;roc_auc&#39;: 0.9900000000000001}}
</pre></div></div>
</div>
<hr class="docutils" />
</section>
</section>
</section>
<section id="9.-Metrics-&amp;-Visualization">
<h2>9. Metrics &amp; Visualization<a class="headerlink" href="#9.-Metrics-&-Visualization" title="Permalink to this headline"></a></h2>
<p>For more information on visualization of performance metrics, reference the <a class="reference external" href="visualization.html">Visualization &amp; Metrics</a> documentation.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>